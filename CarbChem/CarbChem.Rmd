---
title: "Carbon Chemestry explore"
author: "Ana Palacio-Castro"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_height: 5
    fig_width: 7
    df_print: paged
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Libraries and settings

```{r, include=FALSE}
# Libraries
    library(plyr)
    library(tidyverse)
    library(reshape2)
    library(ggthemes)
    library(lubridate)
    library(knitr)
```

# Import and format carbon chemestry data

```{r, include=FALSE}
# Get data
CC.data<-read.csv("Data/NCRMP_CarbonateChemistryData_All_Atlantic_updated.csv", header = T)
  summary(CC.data)
  str((CC.data))

# Format variables     
  CC.data$Year<-as.numeric(CC.data$Year)
  CC.data$Aragonite_Sat_W<-as.numeric((as.character(CC.data$Aragonite_Sat_W)))
  CC.data$Temperature_C <-as.numeric((as.character(CC.data$Temperature_C)))
  CC.data$Date<-as.Date(CC.data$ESTDate, "%m/%d/%Y")
```

# Add seasonality

```{r, include=FALSE}
# Define seasons
  metseasons <- c(
    "01" = "Winter", "02" = "Winter",
    "03" = "Spring", "04" = "Spring", "05" = "Spring",
    "06" = "Summer", "07" = "Summer", "08" = "Summer",
    "09" = "Fall", "10" = "Fall", "11" = "Fall",
    "12" = "Winter"
  )

Seasons<-as.data.frame(metseasons[format(CC.data$Date, "%m")])
colnames(Seasons)<-"Season"
CC.data<-cbind(CC.data, Seasons)

```


# 1. Data available

## Number of samples

### By year and region

```{r, echo=FALSE}
Cases_Reg_Year<-CC.data %>% count(Year, Region, sort = F)


Cases_Reg_Year<-Cases_Reg_Year %>%
    pivot_wider(names_from = Year, values_from = n)

kable(head(Cases_Reg_Year, format = "html"))
```


### By season and region

```{r, echo=FALSE}
Cases_Reg_season<-CC.data %>% count(Season, Region, sort = F)

Cases_Reg_season<-Cases_Reg_season %>%
    pivot_wider(names_from = Season, values_from = n)

kable(head(Cases_Reg_season, format = "html"))
```


## Number of sites per region

Florida Keys 

```{r, echo=FALSE}
Cases_Site_FLK<-filter(CC.data, Region=="FLK") %>% count(Year, SiteID, sort = F)
Cases_Site_FLK

Cases_Site_FLK<-Cases_Site_FLK %>%
    pivot_wider(names_from = Year, values_from = n)

kable(head(Cases_Site_FLK, format = "html"))
```

**Note:** This looks like the original data were the SiteIDs are not curated :( 

Puerto Rico 

```{r, echo=FALSE}
Cases_Site_PR<-filter(CC.data, Region=="PR") %>% count(Year, SiteID, sort = F)
Cases_Site_PR

Cases_Site_PR<-Cases_Site_PR %>%
    pivot_wider(names_from = Year, values_from = n)

kable(head(Cases_Site_PR, format = "html"))
```

**Note:** Each sample has an unique SiteID? 

## Aragonite overview

```{r, echo=FALSE, fig.heigh=8, fig.width=7}
Aragonite<- ggplot(CC.data) + theme_bw() +
  
  scale_y_continuous(limits = c(0,5.5),
                       name=("Aragonite Saturation") ,
                       breaks = seq(0, 5, 1),  
                       expand = c(0, 0)) +
  scale_x_date(name="Date",
               #labels = date_format("%M/%Y"),
               #limits = c(-1,114),
               expand = c(0, 0),
               breaks ="6 months")+
  
  #scale_shape_manual(values=c(21,2,24))+
  #scale_colour_manual(values = c("gray35","gray70", "gray70"))+

geom_point(aes (Date, Aragonite_Sat_W, fill=SiteID), shape=21)+    
#geom_point(aes (Date, Aragonite_Sat_W, fill=Sample_Depth_m), shape=21)+
#geom_line(aes (Date, Aragonite_Sat_W, fill=SiteID), alpha=0.3)+

theme(legend.position="none",
          plot.background=element_blank(),
          axis.text.x = element_text(angle = 90, vjust = 0.5),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          panel.background =element_rect(fill = NA, color = "black")
          ) +
  geom_abline(slope = 0, intercept = 3, color="gray", linetype=2)+
  facet_grid(Region~.)
  
Aragonite
#ggsave(file="Outputs/Aragonite.svg", plot=Aragonite, dpi = 300, width=6, height=4)

```


## Temperature overview

```{r, echo=FALSE}
Temperature_All<- ggplot(CC.data) + theme_bw() +
  
  scale_y_continuous(limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),  
                       expand = c(0, 0)) +
  scale_x_date(name="Date",
               #labels = date_format("%M/%Y"),
               #limits = c(-1,114),
               #expand = c(0, 0),
               breaks ="6 months")+
  
  #scale_shape_manual(values=c(21,2,24))+
  #scale_colour_manual(values = c("gray35","gray70", "gray70"))+
  
geom_point(aes (Date, Temperature_C, fill=Region), shape=21)+
#geom_line(aes (Date, Temperature_C, colour=SiteID))+
 
theme(legend.position="none",
          plot.background=element_blank(),
          axis.text.x = element_text(angle = 90, vjust = 0.5),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          panel.background =element_rect(fill = NA, color = "black")
          ) 
Temperature_All
#ggsave(file="Outputs/Figure_1_Experiment_design.svg", plot=Design, dpi = 300, width=6, height=4)

```

**Note:** Are the 38+ data points real? 

```{r, echo=FALSE,  fig.heigh=8, fig.width=7}
Temperature_Reg_Season<- ggplot(CC.data) + theme_bw() +
  
  scale_y_continuous(limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2.5),  
                       expand = c(0, 0)) +
  scale_x_date(name="Date",
               #labels = date_format("%M/%Y"),
               #limits = c(-1,114),
               #expand = c(0, 0),
               breaks ="6 months")+
  
geom_point(aes (Date, Temperature_C, fill=Season), shape=21)+
#geom_line(aes (Date, Temperature_C, colour=SiteID))+
 
theme(legend.position="none",
          plot.background=element_blank(),
          axis.text.x = element_text(angle = 90, vjust = 0.5),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          panel.background =element_rect(fill = NA, color = "black")
          ) 
Temperature_Reg_Season
#ggsave(file="Outputs/Figure_1_Experiment_design.svg", plot=Design, dpi = 300, width=6, height=4)

Temperature_Reg_Season+facet_grid(Region~.)
```

## Correlations to check outliers

```{r, echo=FALSE}
Relationships<- ggplot(CC.data) + theme_bw() +
  
  scale_y_continuous(limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),
                       expand = c(0, 0)) +
  scale_x_continuous(name="Aragonite",
                 limits = c(0.5,6),
                 expand = c(0, 0),
                 breaks = seq(1,6,1))+
  
geom_point(aes (Aragonite_Sat_W, Temperature_C, fill=Region), alpha=0.5, shape=21)+
#geom_line(aes (Date, Temperature_C, colour=SiteID))+
 
theme(legend.position="none",
          plot.background=element_blank(),
          axis.text.x = element_text(angle = 90, vjust = 0.5),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          panel.background =element_rect(fill = NA, color = "black")
          ) +
  geom_abline(slope = 0, intercept = 29.5, color="gray", linetype=2)+
  geom_vline(xintercept = 3, color="gray", linetype=2)
Relationships
#ggsave(file="Outputs/Figure_1_Experiment_design.svg", plot=Design, dpi = 300, width=6, height=4)
```

# 2. Basic stats summary

```{r, echo=FALSE}
# Temperature
Temp.Season <- ddply (CC.data, .(Region, Season),summarise,
                Tmin = min (Temperature_C, na.rm = F), 
                Tmax = max (Temperature_C, na.rm = F),
                Tmean = mean (Temperature_C, na.rm = F), 
                Tsd = sd (Temperature_C, na.rm = F))

kable(head(Temp.Season, format = "html"))

# Aragonite
Aragonite.Season <- ddply (CC.data, .(Region, Season),summarise,
                Amin = min (Aragonite_Sat_W, na.rm = F), 
                Amax = max (Aragonite_Sat_W, na.rm = F),
                Amean = mean (Aragonite_Sat_W, na.rm = F), 
                Asd = sd (Aragonite_Sat_W, na.rm = F))

kable(head(Aragonite.Season, format = "html"))

```

**Note:** What is limit for the seasons that makes more sense (now jus using months)? 
