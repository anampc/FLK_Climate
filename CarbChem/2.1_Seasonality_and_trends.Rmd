---
title: "Carbon Chemistry analysis: seasonality and long trends"
author: "Ana Palacio-Castro"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    fig_height: 8
    fig_width: 8
    df_print: paged
    toc: yes
    toc_float: true
editor_options:
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      options(knitr.kable.NA = '',
                      rows.print=48))
```

# Libraries and settings

```{r, include=FALSE}
# Libraries
    library(plyr)
    library(tidyverse)
    library(reshape2)
    library(lubridate)
    library(knitr)
    library(dplyr)
    library(broom)

#Plots
    library(ggpubr)
    library(ggthemes)
    library(gridExtra)
    library(ggExtra)
    
#Models     
    library(lmodel2)    
    library(lmerTest)
    library(emmeans)
    library(modelsummary) # model results in table
    library(lsmeans) #cld functon 
    library(jtools) # Plot modesl
    library(kableExtra) # ANOVA tables


# Interactive Maps
    library(leaflet)

# Plots
MyTheme<-theme_bw() +  
theme(legend.position="top",
          plot.background=element_blank(),
          axis.text.x = element_text(angle = 90, vjust = 0.5),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          legend.title = element_blank(),
          panel.background =element_rect(fill = NA, 
                                         color = "black"))#+
  #guides(fill=guide_legend(nrow=2,byrow=TRUE), shape=guide_legend(nrow=3,byrow=TRUE))

Season_fill<-scale_fill_manual(values =
                           c("#abdda4", "#d7191c",
                             "#fdae61", "#2b83ba"))

Season_colour<-scale_colour_manual(values =
                           c("#abdda4", "#d7191c",
                             "#fdae61", "#2b83ba"))

```

# 1. Import and format carbon chemistry data

```{r, include=FALSE}
# 1. Get data
  FLK.data<-read.csv("FLK_results/FLK_filtered_ve3.csv", header = T)

  FLK.data$Location<-NULL
  FLK.data$TA_0<-NULL
  FLK.data$DIC_0<-NULL
  FLK.data$nTA<-NULL
  FLK.data$nDIC<-NULL
  FLK.data$n35TA<-NULL
  FLK.data$n35DIC<-NULL
  FLK.data$Survey_design <-NULL
  FLK.data$Sample_frequency<-NULL
  FLK.data$Sample_Depth_m<-NULL
  FLK.data$Conductivity_Sm<-NULL
  FLK.data$Pressure_db<-NULL
  FLK.data$Density_Sigmat<-NULL
  #head(FLK.data)

# 2. Format variables
  # Date/times
    # Year
    FLK.data$Year<-as.numeric(FLK.data$Year)
    #summary(FLK.data$Year)

    FLK.data$Month<-factor(FLK.data$Month, 
                          levels = c("Apr", "May","Jun",
                                    "Jul", "Aug", "Sep",
                                    "Oct","Nov","Dec",
                                    "Jan", "Feb", "Mar"))
    summary(FLK.data$Month)
    #FLK.data$Months<-months(FLK.data$ESTDate)
    FLK.data$Months<-factor(FLK.data$Months, levels = month.name)
    FLK.data$Date<-as.Date(FLK.data$Date)
    
  FLK.data$Sub_region<-factor(FLK.data$Sub_region, levels = c(
                          "BB", "UK", "MK", "LK"))
  
  FLK.data$Zone<-factor(FLK.data$Zone, levels = c(
                        "Inshore", "Mid channel", 
                        "Offshore", "Oceanic"))
  FLK.data$Reference<-factor(FLK.data$Reference, levels = c(
                        "BB_1", "BB_2", "UK_3", "UK_4", 
                        "MK_5", "MK_6", "MK_7",
                        "LK_8", "LK_9", "LK_10"))
      
  FLK.data$Season<-factor(FLK.data$Season, levels = c(
                        "Spring", "Summer", "Fall", "Winter"))
#summary(FLK.data)
```

## Seasonality

* Spring: March 20-June 18
* Summer: June 19-Sep 20 
* Fall: Sep 21-Dec 19
* Winter: Dec 20-March 19

* Wet: May - October
* Dry: November - April

# 2. Check data available

## 2.1 Locations (all samples)

```{r MapINformation, include=FALSE}
Locations <- FLK.data %>% select(Latitude,
                                Longitude, 
                                Sub_region, 
                                SiteID)
Locations<-unique(Locations)

pal.gen <- colorFactor(palette = "Set1",
                         domain = FLK.data$Zone)
```


```{r AllMap, echo=FALSE}

leaflet(FLK.data, height = '400px') %>%
  addTiles() %>%
  #addProviderTiles(providers$Esri.WorldImagery)%>%
  addProviderTiles(providers$OpenStreetMap) %>%
  #addMarkers(icon=coral.icon) %>%
  addCircleMarkers(lng = ~Longitude, lat = ~Latitude,
                   #stroke = TRUE,
                   radius = 2,
                   fillOpacity = 1,
                   color = ~pal.gen(Zone),
                   label = ~CTDID,
                   labelOptions = labelOptions(
                     noHide = F, direction = "bottom",
                     textOnly = TRUE,
                     style = list(
        "color" = "white")))  %>%
  addLegend(position = "topright",
            pal = pal.gen,
            values = ~Zone, opacity = 1) %>%
  fitBounds(lng1=-81.20, lat=26, lng2=-80.5, lat2=24)

```

**Figure Supp:** Map of the sites where individual samples were collected

**Notes:**
* Check location of individual SiteIDs

## 2.2 Average GPS point location

```{r WS.POINTS, include=FALSE}
WS.GPS.Sites <- ddply (FLK.data, .(Sub_region, Zone, SiteID),summarise,
                Lat = mean (Latitude, na.rm = T), 
                Lon = mean (Longitude, na.rm = T),
                number = n())
#write.csv(WS.GPS.Sites, "FLK_results/1_meanSatationGPS.csv")
```

Flag samples with coordinates that seem off from the permanent station 

```{r}
# Coordinates<-select(FLK.data, "CTDID", "Latitude", "Longitude", "SiteID")
# Coordinates<-join(Coordinates, WS.GPS.Sites, 
#                  type = "left", by="SiteID")
# Coordinates$Lat_diff <- abs(Coordinates$Latitude-Coordinates$Lat)
# Coordinates$Lon_diff <- abs(Coordinates$Longitude-Coordinates$Lon)
# Check.coordinates1 <- Coordinates[(Coordinates$Lat_diff>0.02), ]
# Check.coordinates2 <- Coordinates[(Coordinates$Lon_diff>0.02), ]
# Check.coordinates <- rbind(Check.coordinates1, Check.coordinates2)
# Check.coordinates <- unique(Check.coordinates)
# #write.csv(Check.coordinates, "FLK_results/2_WrongGPS_points.csv", row.names=F)
```


```{r Mean.Map, include=FALSE}
# Map information
pal.gen <- colorFactor(palette = "Set1",
                         domain = WS.GPS.Sites$Zone)
```

```{r WSmap, echo=FALSE}

leaflet(WS.GPS.Sites, height = '550px') %>%
  addTiles() %>%
  #addProviderTiles(providers$Esri.WorldImagery)%>%
  addProviderTiles(providers$OpenStreetMap) %>%

  # Sub_regions
     addRectangles(
      lng1=-80.26, lat1=25.7,
      lng2=-80.02, lat2=25.25,
      opacity = 1,
      color = "black",
      weight=1,
      fillColor = "transparent",
      label = "Biscayne Bay",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                       textOnly = F))  %>%
    addRectangles(
      lng1=-80.6, lat1=25.20,
      lng2=-80.2, lat2=24.8,
      opacity = 1,
      color = "black",
      weight=1,
      fillColor = "transparent",
      label = "Upper Keys",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                       offset = c(20, 20),
                       textOnly = F))  %>%

    addRectangles(
      lng1=-81.11, lat1=24.85,
      lng2=-80.61, lat2=24.55,
      opacity = 1,
      color = "black",
      weight=1,
      fillColor = "transparent",
      label = "Middel Keys",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                        offset = c(15, 20),
                       textOnly = F)) %>%
    addRectangles(
      lng1=-81.88, lat1=24.34,
      lng2=-81.14, lat2=24.72,
      opacity = 1,
      color = "black",
      weight=1,
      fillColor = "transparent",
      label = "Lower Keys",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                         offset = c(20, 30),
                       textOnly = F)) %>%
  #Stations
  addCircleMarkers(lng = ~Lon, lat = ~Lat,
                   stroke = FALSE,
                   radius = 4,
                   fillOpacity = 1,
                   color = ~pal.gen(Zone),
                   label = ~SiteID,
                   labelOptions = labelOptions(
                     noHide = F, direction = "bottom",
                     textOnly = TRUE,
                     style = list(
        "color" = "white")))  %>%

  addLegend(position = "topright",
            pal = pal.gen,
            values = ~Zone, opacity = 1) %>%
  fitBounds(lng1=-81.20, lat=25.75, lng2=-80.5, lat2=24.05)
  
```

**Figure 1:** Permanent location of WS stations

## 2.3 Number of samples

### By zone and location

```{r, echo=FALSE}
Cases_Loc_Zone<-FLK.data %>% count(Sub_region,
                                  Zone,
                                  sort = F)

Cases_Loc_Zone<-as.data.frame(Cases_Loc_Zone %>%
                   pivot_wider(names_from = Zone,
                   values_from = n))
#write.csv(Cases_Loc_Zone, "FLK_results/SampleS_Region_zone.csv")

kable(as.data.frame(Cases_Loc_Zone, format = "markdown"), 
      longtable = TRUE)
```

### By year and sub_region

```{r, echo=FALSE}
Cases_Reg_Year<-FLK.data %>% count(Year, Sub_region, sort = F)

Cases_Reg_Year<-as.data.frame(Cases_Reg_Year %>%
    pivot_wider(names_from = Year, values_from = n))
#write.csv(Cases_Reg_Year, "FLK_results/SampleS_Region_Year.csv")

kable(as.data.frame(Cases_Reg_Year, format = "html"),  caption = "Samples collected each year")
```

### By climatological season and region

```{r, echo=FALSE}
Cases_Reg_season<-FLK.data %>% count(Season, Sub_region, sort = T)

Cases_Reg_season<-as.data.frame(Cases_Reg_season %>%
    pivot_wider(names_from = Season, values_from = n))
#write.csv(Cases_Reg_season, "FLK_results/SampleS_RegionSeason.csv")

kable(as.data.frame(Cases_Reg_season, format = "html"),
      caption = "Samples collected in each season")
```

### By Month-year

```{r, echo=FALSE}
Cases_Month<-FLK.data %>% count(Months,
                                Year,
                                sort = F)

Cases_Month<-as.data.frame(Cases_Month %>%
    pivot_wider(names_from = Year, values_from = n))

# Organize table
 Cases_Month<-Cases_Month %>% 
     select(sort(names(.)))

kable(as.data.frame(Cases_Month, format = "html"), caption="Samples collected by year-month")
#write.csv(Cases_Month, "FLK_results/SampleS_Month_Year.csv")
```

### By Season-year

```{r, echo=FALSE}
Cases_Season<-FLK.data %>% count(Season,
                                Year,
                                sort = F)

Cases_Season<-as.data.frame(Cases_Season %>%
    pivot_wider(names_from = Year, values_from = n))

# Organize table
 Cases_Season<-Cases_Season %>% 
     select(sort(names(.)))

kable(as.data.frame(Cases_Season, format = "html"), caption="Samples collected by year-month")
#write.csv(Cases_Season, "FLK_results/SampleS_Season_Year.csv")
```

### By Month-region

```{r, echo=FALSE}

Cases_Month_Location<-FLK.data %>% count(Sub_region,
                                Zone,
                                Month, sort = F)

Cases_Month_Location<-as.data.frame(Cases_Month_Location %>%
    pivot_wider(names_from = Month, values_from = n))
#write.csv(Cases_Month_Location, "FLK_results/SampleS_Monthlocation.csv")

kable(as.data.frame(Cases_Month_Location, format = "html"),
      caption="Samples collected by month-location")
```

### Per station during all sampling time

```{r, echo=FALSE}
Cases_Site_FLK<-FLK.data %>% count(Year, SiteID, sort = F)
#Cases_Site_FLK

Cases_Site_FLK<-as.data.frame(Cases_Site_FLK %>%
    pivot_wider(names_from = Year, values_from = n))
#write.csv(Cases_Site_FLK, "FLK_results/SampleSiteIDFLK.csv")

kable(as.data.frame(Cases_Site_FLK, format = "html"),
      caption = "Samples collected in SiteIDs")
```

## Remove extreme events?

```{r}
# Label and filter extreme events
  FLK.data$Extreme<-as.factor(FLK.data$Extreme)
  summary(FLK.data$Extreme)
  FLK.data_filtered<-FLK.data[FLK.data$Extreme=="Normal",]
  
```


# 3. TA and DIC salinity normalization

## Salinity standardizations 

1. Used salinity Bottle first, if not available, salinity CTD

```{r}
#MeanSalinity<-mean(FLK.data[FLK.data$Zone=="Oceanic",]$BestSalinity)
MeanSalinity<-mean(FLK.data$BestSalinity)
sdSalinity<-sd(FLK.data$BestSalinity)

Sal<-paste("Mean salinity = ", round(MeanSalinity, digits=3),
           "(", round(sdSalinity, digits=3), ")")
Sal
```

```{r}
# TA_Sal<- ggplot(FLK.data) + MyTheme+
#   geom_point(aes (BestSalinity, TA_umol_kg, fill=Season), 
#              alpha=0.5, shape=21, size=1)+
#   geom_smooth(aes(BestSalinity, TA_umol_kg), 
#               linetype=2, method = "lm", color="black")
# 
# ggExtra::ggMarginal(
#   p = TA_Sal,
#   type = 'boxplot',
#   margins = 'both',
#   size = 5,
#   colour = 'black',
#   fill = 'gray'
# )
# 
# TA_Sal + facet_wrap(~Zone)
# TA_Sal+ facet_grid(Zone~Season)
# #TA_Sal+ facet_grid(Zone~Precipitation)
# 
# DIC_Sal<- ggplot(FLK.data) + MyTheme+
#   geom_point(aes (BestSalinity, DIC_umol_kg, fill=Season), 
#              alpha=0.5, shape=21, size=1)+
#   geom_smooth(aes(BestSalinity, DIC_umol_kg), 
#               linetype=2, method = "lm", color="black")
#   
# ggExtra::ggMarginal(
#   p = DIC_Sal,
#   type = 'boxplot',
#   margins = 'both',
#   size = 5,
#   colour = 'black',
#   fill = 'gray'
# )
# 
# DIC_Sal + facet_wrap(~Zone)
# DIC_Sal+ facet_grid(Zone~Season)
```

2. Calculate TA intercepts

**Note: Use Model II Linera regressions!**

"For Model II regressions, neither X nor Y is an INDEPENDENT variable but both are assumed to be DEPENDENT on some other parameter which is often unknown. Neither are “controlled”, both are measured, and both include some error. We do not seek an equation of how Y varies in response to a change in X, but rather we look for how they both co-vary in time or space in response to some other variable or process." 

* Use ordinary least squares (OLS)? 


```{r, echo=FALSE, fig.height=4, fig.width=8}
# TA_coef <- FLK.data %>% 
#                  group_by(Region) %>%
#                  do({model = lm(TA_umol_kg~BestSalinity, data=.)  # model
#                      data.frame(tidy(model), # get coefficient info
#                     glance(model))})        # get model info
TA_coef <- FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",] %>%
                group_by(Region) %>%
                do({model = lm(TA_umol_kg~BestSalinity, data=.)  # model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

# TA_coef <- FLK.data[FLK.data$Zone=="Oceanic",] %>%
#                 group_by(Region) %>%
#                 do({model = lmodel2(TA_umol_kg~BestSalinity, data=.)  # model
#                     data.frame(tidy(model), # get coefficient info
#                     glance(model))})        # get model info

TA_coe <- lmodel2(TA_umol_kg~BestSalinity,
            data=FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",])
TA_coe

par(mfrow=c(1,3))
  plot(TA_coe, "OLS")
  plot(TA_coe, "MA")
  plot(TA_coe, "SMA")
par(mfrow=c(1,1))
```

3. Calculate DIC intercepts 

```{r, echo=FALSE, fig.height=4, fig.width=8}
# 3.DIC normalization to intercept  

    # DIC_coef <- FLK.data %>%
    #               group_by(Region) %>%
    #               do({model = lm(DIC_umol_kg~BestSalinity, data=.)
    #               # create model
    #               data.frame(tidy(model), # get coefficient info
    #               glance(model))})        # get model info
    
 DIC_coef <- FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",] %>%
                  group_by(Region) %>%
                  do({model = lm(DIC_umol_kg~BestSalinity, data=.)
                  # create model
                  data.frame(tidy(model), # get coefficient info
                  glance(model))})        # get model info

  DIC_coe <- lmodel2(DIC_umol_kg~BestSalinity,
                data=FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",])
  DIC_coe
  
  par(mfrow=c(1,3))
    plot(DIC_coe, "OLS")
    plot(DIC_coe, "MA")
    plot(DIC_coe, "SMA")
  par(mfrow=c(1,1))
```

4. Add TA and DIC endmembers (S=0) to data frame

```{r}
# 4. Add endmember intercepts

  TA_SO<-subset(TA_coef, term=="(Intercept)")
  TA_SO<-as.data.frame(select(TA_SO, c(Region, estimate)))
  names(TA_SO)[2] <- "TA_0"
  
  DIC_SO<-subset(DIC_coef, term=="(Intercept)")
  DIC_SO<-as.data.frame(select(DIC_SO, c(Region, estimate)))
  names(DIC_SO)[2] <- "DIC_0"
    
  Intercepts<-join(TA_SO, DIC_SO, by="Region", type="full")
  FLK.data<-join(FLK.data, Intercepts, by="Region", type="left")
```

5. Normalize with (1) Friss equation and (2) mean salinity

```{r}
  # 5. endmember and salinity (mean) normalization
  FLK.data$nTA<-((
    (FLK.data$TA_umol_kg-FLK.data$TA_0)/
    FLK.data$BestSalinity)*MeanSalinity)+FLK.data$TA_0
  
  FLK.data$nDIC<-((
    (FLK.data$DIC_umol_kg-FLK.data$DIC_0)/
    FLK.data$BestSalinity)*MeanSalinity)+FLK.data$DIC_0
  
  # 2. TA and DIC 35 normalization
    FLK.data$n35TA<-(FLK.data$TA_umol_kg/FLK.data$BestSalinity)*MeanSalinity
    FLK.data$n35DIC<-(FLK.data$DIC_umol_kg/FLK.data$BestSalinity)*MeanSalinity
    # FLK.data$n35TA<-(FLK.data$TA_umol_kg/FLK.data$BestSalinity)*35
    # FLK.data$n35DIC<-(FLK.data$DIC_umol_kg/FLK.data$BestSalinity)*35
  
#write.csv(FLK.data, "FLK_results/FLK.data_filtered_normalized.csv", row.names = F)
```

6. TA parameters to nTA (S=0)

```{r}
kable(as.data.frame(TA_coef[,1:8], format = "markdown"), 
      caption = "Table 1: TA parameters for salinity normalization with endmember S0",
      digits = 3)
#write.csv(TA_coef, "TA_coef.csv")

```
    
```{r, echo=F, fig.height=4, fig.width=8.8}
# 5. Chech normalization?
nTA_Sal<- ggplot(FLK.data) + MyTheme+
  
  geom_point(aes (BestSalinity, TA_umol_kg, fill=Extreme),
             alpha=0.5, shape=21, size=1)+
  geom_smooth(aes(BestSalinity, TA_umol_kg),
              linetype=2, method = "lm", color="black")+
    
  geom_point(aes (BestSalinity, nTA, fill=Extreme),
             alpha=0.5, shape=24, size=1)+
  geom_smooth(aes(BestSalinity, nTA),
              linetype=1, method = "lm")+  
    
  geom_point(aes (BestSalinity, n35TA, fill=Extreme),
             alpha=0.5, shape=25, size=1)+
  geom_smooth(aes(BestSalinity, n35TA), 
              linetype=1, method = "lm",  color="red")  
```

7. DIC parameters to nDIC (S=0)

```{r}
kable(as.data.frame(DIC_coef[,1:8], format = "markdown"), 
      caption = "Table 2: DIC parameters for salinity normalization with endmember S0",
      digits = 2)

#write.csv(DIC_coef, "DIC_coef.csv")
    
```

```{r, echo=F, fig.height=8.8, fig.width=8.8}
nDIC_Sal<- ggplot(FLK.data) + MyTheme+
  
  geom_point(aes (BestSalinity, DIC_umol_kg, fill=Extreme),
             alpha=0.5, shape=21, size=1)+
  geom_smooth(aes(BestSalinity, DIC_umol_kg),
              linetype=2, method = "lm", color="black")+
    
  geom_point(aes (BestSalinity, nDIC, fill=Extreme),
             alpha=0.5, shape=24, size=1)+
  geom_smooth(aes(BestSalinity, nDIC),
              linetype=1, method = "lm")+  
    
  geom_point(aes (BestSalinity, n35DIC,
                  fill=Extreme), alpha=0.5, shape=25, size=1)+
  geom_smooth(aes(BestSalinity, n35DIC),
              linetype=1, method = "lm",  color="red")
```

```{r,echo=FALSE, fig.height=4, fig.width=8}
FLK_parameters<-ggarrange(nTA_Sal, nDIC_Sal,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1)
FLK_parameters
```

**Figure Supp 1:** Overview of linear regressions of total alkalinity (TA, µmol kg−1) and dissolved inorganic carbon (DIC, µmol kg−1) as a function of salinity + Friss normalized values.

* Original data: Black line and circles
* Friis normalization S0 endmember: blue line and pointing up triangles
* Mean salinity normalization: red line and pointing down triangles

### TA vs Friss salinity normalized TA

```{r, echo=FALSE, fig.height=4, fig.width=8}
nTA_TA<- ggplot(FLK.data, aes (TA_umol_kg, nTA)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                    name="nTA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                      name="TA")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

nTA_TA_ext<-nTA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#nTA_TA_ext

nTA_TA_pre<-nTA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#nTA_TA_pre

nTA_TA_plots<-ggarrange(nTA_TA_ext, nTA_TA_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
nTA_TA_plots
```

**Figure Supp X:** Linear regressions of Friss normalized total alkalinity (nTA, µmol kg−1) as a function of measured Total Alcalinity (TA, µmol kg−1)

### DIC vs Friss salinity normalized DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
nDIC_DIC<- ggplot(FLK.data, aes (DIC_umol_kg, nDIC)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                    name="nDIC") +
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                      name="DIC")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

nDIC_DIC_ext<-nDIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#nDIC_DIC_ext

nDIC_DIC_pre<-nDIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#nDIC_DIC_pre

nDIC_DIC_plots<-ggarrange(nDIC_DIC_ext, nDIC_DIC_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
nDIC_DIC_plots
```

**Figure Supp X:** Linear regressions of Friss normalized Dissolved Inorganc Carbon (nDIC, µmol kg−1) as a function of measured Dissolved Inorganc Carbon (DIC, µmol kg−1)

### TA vs Salinity normalized TA  

```{r, echo=FALSE, fig.height=4, fig.width=8}
n35TA_TA<- ggplot(FLK.data, aes (TA_umol_kg, n35TA)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                    name="n35TA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="TA")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

n35TA_TA_ext<-n35TA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#n35TA_TA_ext

n35TA_TA_pre<-n35TA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#n35TA_TA_pre

n35TA_TA_plots<-ggarrange(n35TA_TA_ext, n35TA_TA_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
n35TA_TA_plots
```

**Figure Supp X:** Linear regressions of mean salinity normalized total alkalinity (n35TA, µmol kg−1) as a function of measured Total Alcalinity (TA, µmol kg−1)

### DIC vs Salinity normalized DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
n35DIC_DIC<- ggplot(FLK.data, aes (DIC_umol_kg, n35DIC)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                     name="n35DIC") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="DIC")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

n35DIC_DIC_ext<-n35DIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#n35DIC_DIC_ext

n35DIC_DIC_pre<-n35DIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#n35DIC_DIC_pre

nDIC_DIC_plots<-ggarrange(n35DIC_DIC_ext, n35DIC_DIC_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
nDIC_DIC_plots
```

**Figure Supp X:** Linear regressions of mean salinity normalized Dissolved Inorganc Carbon (n35DIC, µmol kg−1) as a function of measured Dissolved Inorganc Carbon (DIC, µmol kg−1)

### Differences vs Salinity

```{r, echo=FALSE, fig.height=4, fig.width=4}
TAdiff<- ggplot(FLK.data, aes (BestSalinity, TA_umol_kg-n35TA)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                    name="TA - n35TA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="Salinity")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

TAdiff_pre<-TAdiff +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)

TAdiff<-ggExtra::ggMarginal(
  p = TAdiff_pre,
  type = 'boxplot',
  margins = 'both',
  size = 5,
  colour = 'black',
  fill = 'gray'
)
```

```{r, echo=FALSE, fig.height=4, fig.width=4}
DICdiff<- ggplot(FLK.data, aes (BestSalinity, DIC_umol_kg-n35DIC)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                    name="DIC - n35DIC") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="Salinity")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

DICdiff_pre<-DICdiff +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)

DICdiff_pre<-ggExtra::ggMarginal(
  p = DICdiff_pre,
  type = 'boxplot',
  margins = 'both',
  size = 5,
  colour = 'black',
  fill = 'gray'
)

```

```{r, echo=FALSE, fig.height=4, fig.width=8}
Difference_plots<-ggarrange(TAdiff, DICdiff_pre,
          #labels = c("A", "B"),
          ncol = 2, nrow = 1)
Difference_plots
```

**Figure Supp X:** Linear regressions of (A) TA-n35TA and (B) DIC-nDIC as a function of Salinity

# 4. Endmember comparissions

```{r}
FLK.data_filtered<-FLK.data[FLK.data$Extreme=="Normal",]
```

## 4.1 TA and DIC relation

```{r}
TA_DIC<- ggplot(FLK.data, aes (DIC_umol_kg, TA_umol_kg)) +

  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                     expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                     expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  facet_grid(Zone~Sub_region)+ MyTheme+
  guides(fill=guide_legend(override.aes=list(shape=21)))

```

<!-- ## 3.1 All FLK samples) -->

```{r, fig.height=8.8, fig.width=8.8}
# TA_DIC_ext<-TA_DIC +
#    scale_shape_manual(values=c(21,21,24, 24))+
#   geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)+
#   geom_smooth(method = "lm", colour="black")
# TA_DIC_ext

```

```{r, fig.height=8.8, fig.width=8.8}
# TA_DIC_pre<-TA_DIC +
#   scale_shape_manual(values=c(21,21,24, 24))+
#   geom_point(aes (fill=Precipitation,  shape=Zone), alpha=0.4)+
#   geom_smooth(method = "lm", colour="black")
# TA_DIC_pre
```

```{r}
 # Individual LR for each Zone and Sub_region
  # TA_DIC_coef_zone <- FLK.data %>% 
  #                   group_by(Zone, Sub_region) %>%
  #                   do({model = lm(TA_umol_kg ~ DIC_umol_kg, data=.)  
  #                   # create model
  #                   data.frame(tidy(model), # get coefficient info
  #                   glance(model))})        # get model info
  # 
  #   kable(as.data.frame(TA_DIC_coef_zone[,1:8], format = "markdown"),
  #         caption = "TA vs DIC equations with all data", digits = 3)
```

<!-- ## 3.2 All normalized (all FLK samples) -->

```{r}
nTA_nDIC<- ggplot(FLK.data, aes (n35DIC, n35TA)) +
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                    name="Salinity-nTA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                      name="Salinity-nDIC")+
  facet_grid(Zone~Sub_region) + MyTheme+
  guides(fill=guide_legend(override.aes=list(shape=21)))

```

```{r, fig.height=8, fig.width=8}
# nTA_nDIC_ext<-nTA_nDIC +
#    scale_shape_manual(values=c(21,21,24, 24))+
#   geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)+
#   geom_smooth(method = "lm", colour="black")
 
```

```{r, fig.height=8.8, fig.width=8.8}
# nTA_nDIC_pre<-nTA_nDIC +
#   scale_shape_manual(values=c(21,21,24, 24))+
#   geom_point(aes (fill=Precipitation,  shape=Zone), alpha=0.4)+
#   geom_smooth(method = "lm", colour="black")
# nTA_nDIC_pre
 
```

```{r}
 # Individual LR for each Zone and Sub_region
    # TA_DIC_coef_zone <- FLK.data %>% 
    #                 group_by(Zone, Sub_region) %>%
    #                 do({model = lm(nTA~nDIC, data=.)  
    #                 # create model
    #                 data.frame(tidy(model), # get coefficient info
    #                 glance(model))})        # get model info
    # 
    # kable(as.data.frame(TA_DIC_coef_zone[,1:8], format = "markdown"),
    #       caption = "nTA vs nDIC equations", digits = 3)
```

## 4.3 Removing extreme events

```{r, fig.height=8.8, fig.width=8.8}
# TA_DIC_Extreme_ex <-TA_DIC+ 
#   geom_point(data=FLK.data, aes (DIC_umol_kg, TA_umol_kg, fill=Extreme), 
#              shape=21, alpha=0.8, size=1)+
#   geom_smooth(data=FLK.data[FLK.data$Extreme=="Normal", ], 
#               aes (DIC_umol_kg, TA_umol_kg), method = "lm", colour="black")
# TA_DIC_Extreme_ex

```

```{r}
TA_DIC_Zone <- ddply (FLK.data[FLK.data$Extreme=="Normal", ], .(Zone),summarise,
                TAmean = mean (TA_umol_kg, na.rm = T), 
                DICmean = mean (DIC_umol_kg, na.rm = T),
                nTAmean = mean (n35TA, na.rm = T), 
                nDICmean = mean (n35DIC, na.rm = T),
                TAsd = sd (TA_umol_kg, na.rm = T), 
                DICsd = sd (DIC_umol_kg, na.rm = T),
                nTAsd = sd (n35TA, na.rm = T), 
                nDIsd = sd (n35DIC, na.rm = T))

TA_DIC_Ocean<-TA_DIC_Zone[TA_DIC_Zone$Zone=="Oceanic", ]

kable(as.data.frame(TA_DIC_Zone, format = "markdown"), caption = "Mean TA/DIC by zone")
```

**Note: Use Model II Linera regressions!**

"For Model II regressions, neither X nor Y is an INDEPENDENT variable but both are assumed to be DEPENDENT on some other parameter which is often unknown. Neither are “controlled”, both are measured, and both include some error. We do not seek an equation of how Y varies in response to a change in X, but rather we look for how they both co-vary in time or space in response to some other variable or process."

```{r}
# Individual LR for each Zone and Sub_region
    
TA_DIC_coef_zone_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Sub_region) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

TA_DIC_coef_zone_noExtremes<-subset(TA_DIC_coef_zone_noExtremes, term!="(Intercept)")
kable(as.data.frame(TA_DIC_coef_zone_noExtremes[,1:8], 
      format = "markdown"),
      caption = "TA vs DIC equations without extreme events",
      digits = 2)


#write.csv(TA_DIC_coef_zone_noExtremes, "FLK_results/Fig_2_TA_DIC_coef_slopes_Subregion.csv", row.names = FALSE)

# Annotations for plots
  coef_zone_noExtremes<-select(TA_DIC_coef_zone_noExtremes, 
                               c("Zone", "Sub_region", "estimate", "r.squared"))
  coef_zone_noExtremes$estimate<-round(coef_zone_noExtremes$estimate, digits=2)
  coef_zone_noExtremes$r.squared<-round(coef_zone_noExtremes$r.squared, digits=2)
```

Type II Linear regression

```{r}
TA_DIC_coef_zone_noExtII <- FLK.data[FLK.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Sub_region) %>%
                    do({model = lmodel2(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info
TA_DIC_coef_zone_noExtII

TA_DIC_coef_zone_noExtII<-subset(TA_DIC_coef_zone_noExtII, term!="Intercept")
kable(as.data.frame(TA_DIC_coef_zone_noExtII[,1:9], 
      format = "markdown"),
      caption = "TA vs DIC equations without extreme events using type II lm",
      digits = 2)

# Annotations for plots
  TA_DIC_coef_zone_noExtII<-select(TA_DIC_coef_zone_noExtII, 
                               c("Zone", "Sub_region","method", "estimate", "r.squared"))
  TA_DIC_coef_zone_noExtII$estimate<-round(TA_DIC_coef_zone_noExtII$estimate, digits=2)
  TA_DIC_coef_zone_noExtII$r.squared<-round(TA_DIC_coef_zone_noExtII$r.squared, digits=2)


```

```{r}


TA_DIC_Extreme_pre<-TA_DIC + 
  geom_abline(intercept = -1700, slope=2, color="grey")+
  geom_hline (yintercept = TA_DIC_Ocean$TAmean, color="grey")+
  scale_shape_manual(values=c(24, 25, 21))+
  geom_point(data=FLK.data, aes (DIC_umol_kg, TA_umol_kg,
                                 fill=Precipitation, shape=Extreme),
                            alpha=0.8, size=1)+
  geom_smooth(data=FLK.data[FLK.data$Extreme=="Normal", ], 
              aes(DIC_umol_kg, TA_umol_kg), method = "lm", colour="black")+
  
  geom_text(data = coef_zone_noExtremes, aes(x = TA_DIC_Ocean$DICmean,
                                             y = 2070,
                    label = paste("Sl =", estimate,  " r.sq=", r.squared)),
            size=2.5)+
  
  # geom_abline(slope = 0, intercept =TA_DIC_Ocean$TAmean, 
  #           linetype=2, colour="gray")+
  # geom_vline(xintercept = TA_DIC_Ocean$DICmean,
  #          linetype=2, colour="gray")+
  geom_point(aes(x=TA_DIC_Ocean$DICmean, y=TA_DIC_Ocean$TAmean),
             size=3, alpha=1, shape=21, fill="black")
#TA_DIC_Extreme_pre

```

<!-- **Figure 2a:** Linear regressions of total alkalinity (TA; µmol kg−1) and dissolved inorganic carbon (DIC; µmol kg−1) -->

## 4.4 Removing extreme events normalized (mean salinity)

```{r}
# Individual LR for each Zone and Sub_region
    
nTA_nDIC_coef_zone_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>%
                    group_by(Zone, Sub_region) %>%
                    do({model = lm(n35TA~n35DIC, data=.)
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

nTA_nDIC_coef_zone_noExtremes<-subset(nTA_nDIC_coef_zone_noExtremes, term!="(Intercept)")

kable(as.data.frame(nTA_nDIC_coef_zone_noExtremes[,1:8],
      format = "markdown"),
      caption = "nTA vs nDIC equations without extreme events",
      digits = 2)

#write.csv(TA_DIC_coef_zone_noExtremes, "FLK_results/Fig_2_TA_DIC_coef_slopes_Subregion.csv", row.names = FALSE)
    
```


```{r}
ncoef_zone_noExtremes<-select(nTA_nDIC_coef_zone_noExtremes, 
                             c("Zone", "Sub_region", "estimate", "r.squared"))
ncoef_zone_noExtremes$estimate<-round(ncoef_zone_noExtremes$estimate, digits=2)
ncoef_zone_noExtremes$r.squared<-round(ncoef_zone_noExtremes$r.squared, digits=2)

nTA_nDIC_Extreme_pre<-nTA_nDIC +
    geom_abline(intercept = -1700, slope=2, color="grey")+
    geom_hline (yintercept = 2381.6, color="grey")+
    scale_shape_manual(values=c(24, 25, 21))+
    geom_point(data=FLK.data, aes (n35DIC, n35TA,
                                   fill=Precipitation, shape=Extreme),
               alpha=0.8, size=1)+
    geom_smooth(data=FLK.data[FLK.data$Extreme=="Normal", ],
                aes(n35DIC, n35TA), method = "lm", colour="black")+
    
    geom_text(data = ncoef_zone_noExtremes, aes(x = TA_DIC_Ocean$nDICmean,
                                                y = 2000,
                    label = paste("Sl=", estimate,  " r.sq=", r.squared)),
              size=2.5)+

    # geom_abline(slope = 0, intercept =TA_DIC_Ocean$nTAmean,
    #           linetype=2, colour="gray")+
    # geom_vline(xintercept = TA_DIC_Ocean$nDICmean,
    #          linetype=2, colour="gray")+
    geom_point(aes(x=TA_DIC_Ocean$nDICmean, y=TA_DIC_Ocean$nTAmean),
             size=3, alpha=1, shape=21, fill="black")
#nTA_nDIC_Extreme_pre

```

<!-- **Figure 2a:** Linear regressions of total alkalinity (nTA; µmol kg−1) and dissolved inorganic carbon (nDIC; µmol kg−1) -->

## 4.5 By reef - Removing Extreme events

```{r, fig.height=8, fig.width=8.8}
TA_DIC_reef_pre<-TA_DIC_Extreme_pre + 
  facet_grid(Zone~Reference)
#TA_DIC_reef_pre
```

<!-- **Figure Sup:** Linear regressions of total alkalinity (TA; µmol kg−1) and dissolved inorganic carbon (DIC; µmol kg−1) by reef and zone -->

```{r}
# Individual LR for each reef
TA_DIC_coef_Reef_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Sub_region, Reference, Precipitation) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

TA_DIC_coef_Reef_noExtremes<-subset(TA_DIC_coef_Reef_noExtremes, term!="(Intercept)")
kable(as.data.frame(TA_DIC_coef_Reef_noExtremes[,1:11],
                      format = "markdown"),
        caption = "TA vs DIC equations by reef without extreme events",
        digits = 2)
#write.csv (TA_DIC_coef_Reef_noExtremes, "FLK_results/Fig_2_TA_DIC_slopes_Reefs.csv", row.names = FALSE)
  
  
  TA_DIC_coef_Reef_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Region, Sub_region, Transect, Precipitation) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info


```

```{r, fig.height=8, fig.width=4}
Slopes_reef<-subset(TA_DIC_coef_Reef_noExtremes, term!="(Intercept)")

Slope_plot<-ggplot(data=Slopes_reef, aes (x =Sub_region, y =estimate)) +
  MyTheme+
  scale_shape_manual(values=c(22, 23, 25))+
  geom_boxplot(aes())+
  geom_jitter(aes(fill = factor(Precipitation), shape = Transect), width = 0.25)+
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                     expression(paste("TA vs DIC slope")))+
  facet_grid(Zone~Region)+
  guides(fill=FALSE)+
  theme(legend.title = element_blank())
#Slope_plot

```

<!-- **Figure 2b:** TA (µmol kg−1) vs DIC (µmol kg−1) slopes -->

```{r,  echo=FALSE}
FLK_slopes<-ggarrange(TA_DIC_Extreme_pre, Slope_plot,
          labels = c("(A)", "(B)"),
          ncol = 2, nrow = 1, widths = c(4, 1.3))
FLK_slopes

#ggsave(file="FLK_results/Fig_2_FLK_slopes.svg", plot=FLK_slopes, dpi = 300, width=8, height=8)
  
```

**Figure 2:** TA (µmol kg−1) vs DIC (µmol kg−1) slopes per season and reef

## 4.6 By reef - Removing Extreme events-normalized

```{r, fig.height=8, fig.width=8.8}
nTA_nDIC_reef_pre<-nTA_nDIC_Extreme_pre +
  facet_grid(Zone~Reference)
#nTA_nDIC_reef_pre
```

<!-- **Figure S:** Linear regressions of total alkalinity (nTA; µmol kg−1) and dissolved inorganic carbon (nDIC; µmol kg−1) by reef and zone -->

```{r}
# Individual LR for each reef
nTA_nDIC_coef_Reef_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>%
                    group_by(Zone, Sub_region, Reference, Precipitation) %>%
                    do({model = lm(n35TA~n35DIC, data=.)
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info
nTA_nDIC_coef_Reef_noExtremes<-subset(nTA_nDIC_coef_Reef_noExtremes, term!="(Intercept)")
kable(as.data.frame(nTA_nDIC_coef_Reef_noExtremes[,1:11],
                      format = "markdown"),
        caption = "TA vs DIC equations by reef without extreme events",
        digits = 2)
#write.csv (nTA_nDIC_coef_Reef_noExtremes, "FLK_results/Fig_2_nTA_nDIC_slopes_Reefs.csv", row.names = FALSE)

nTA_nDIC_coef_Reef_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>%
                    group_by(Zone, Region, Sub_region, Transect, Precipitation) %>%
                    do({model = lm(n35TA~n35DIC, data=.)
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info


```

```{r, fig.height=8, fig.width=5}
nSlopes_reef<-subset(nTA_nDIC_coef_Reef_noExtremes, term!="(Intercept)")

nSlopes_reef<-ggplot(data=nSlopes_reef, aes (x =Sub_region, y =estimate)) +
  MyTheme+
  scale_shape_manual(values=c(22, 23, 25))+
  geom_boxplot(aes())+
  geom_jitter(aes(fill = factor(Precipitation), shape = Transect), width = 0.25)+
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                     expression(paste("nTA vs nDIC slope")))+
  facet_grid(Zone~Region)+
   guides(fill=FALSE)+
  theme(legend.title = element_blank())
#nSlopes_reef

```

<!-- **Figure 2b:** nTA (µmol kg−1) vs nDIC (µmol kg−1) slopes -->

```{r,  echo=FALSE}
FLK_nslopes<-ggarrange(nTA_nDIC_Extreme_pre, nSlopes_reef,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
FLK_nslopes

#ggsave(file="FLK_results/Fig_2_FLK_slopes.svg", plot=FLK_slopes, dpi = 300, width=6, height=6.2)
  
```

<!-- **Figure 2:** nTA (µmol kg−1) vs nDIC (µmol kg−1) slopes per season and reef -->

# 5 Seasonal plots

## Data for endmember comparisons

```{r}
# Reef
  WS.reef<-subset(FLK.data, FLK.data$Zone!="Oceanic")
  WS.reef$Date<-as.Date(WS.reef$Date, "%Y-%m-%d")
  
# Open
  WS.open<-subset(FLK.data_filtered,
                  FLK.data_filtered$Zone=="Oceanic")
  WS.open$Date<-as.Date(WS.open$Date, "%Y-%m-%d")
  #summary(WS.open)
```


```{r}
# Mean ocean values by month - year 
  mean_Open_MY<- ddply (WS.open, .(MY, Month),
                            summarise,
                  OTem_my = mean (Temperature_C, na.rm = T),  
                  OSal_my = mean (BestSalinity, na.rm = T), 
                  
                  OTA_my = mean (TA_umol_kg, na.rm = T),
                  OnTA_my = mean (n35TA, na.rm = T),
                  
                  ODIC_my = mean (DIC_umol_kg, na.rm = T),
                  OnDIC_my = mean (n35DIC, na.rm = T),
                  
                  OpCO2_O = mean (pCO2_uatm , na.rm = T),
                  OpH_O = mean (pH_calculated, na.rm = T),
                  OAra_O = mean (Aragonite_Sat_W , na.rm = T)
                  )

# Mean ocean values by month
  mean_OpM <- mean_Open_MY %>%
              group_by(Month) %>%
              summarise(
                  OTem_m = mean (OTem_my, na.rm = T), 
                  OSal_m = mean (OSal_my, na.rm = T), 
                  
                  OTA_m = mean (OTA_my, na.rm = T),
                  OnTA_m = mean (OnTA_my, na.rm = T),
                  
                  OnDIC_m = mean (OnDIC_my, na.rm = T),
                  ODIC_m = mean (ODIC_my, na.rm = T),
                  
                  OpCO2_m = mean (OpCO2_O , na.rm = T),
                  OpH_m = mean (OpH_O, na.rm = T),
                  OAra_m = mean (OAra_O, na.rm = T),
                  n = n()
                  )
   #mean_OpM
  
 # Mean ocean values by year    
  mean_Op<- mean_OpM %>%
            summarise(
                  OTem = mean (OTem_m, na.rm = T), 
                  OSal  = mean (OSal_m, na.rm = T), 
                  
                  OTA = mean (OTA_m, na.rm = T),
                  OnTA = mean (OnTA_m, na.rm = T),
                  
                  OnDIC = mean (OnDIC_m, na.rm = T),
                  ODIC = mean (ODIC_m, na.rm = T),
                  
                  OpCO2 = mean (OpCO2_m, na.rm = T),
                  OpH = mean (OpH_m, na.rm = T),
                  OAra = mean (OAra_m, na.rm = T),
                  n = n()
                  )
```


## 5.1 Month raw values 

## - Months stats

```{r}
Month_Stats<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month, Region),
                            summarise,
                       
                  Tem_mean = mean (Temperature_C, na.rm = T),
                  Tem_sd = sd (Temperature_C, na.rm = T),
                  
                  Sal_mean = mean (BestSalinity, na.rm = T),
                  Sal_sd = sd (BestSalinity, na.rm = T),
                       
                  TA_mean = mean (TA_umol_kg, na.rm = T),
                  TA_sd = sd (TA_umol_kg, na.rm = T),
                  
                  nTA_mean = mean (n35TA, na.rm = T),
                  nTA_sd = sd (n35TA, na.rm = T),
                  
                  nDIC_mean = mean (n35DIC, na.rm = T),
                  nDIC_sd = sd (n35DIC, na.rm = T),
                  
                  DIC_mean = mean (DIC_umol_kg, na.rm = T),
                  DIC_sd = sd (DIC_umol_kg, na.rm = T),
                  
                  pCO2_mean = mean (pCO2_uatm , na.rm = T),
                  pCO2_sd = sd (pCO2_uatm , na.rm = T),
                  
                  pH_mean = mean (pH_calculated, na.rm = T),
                  pH_sd = sd (pH_calculated, na.rm = T),
                  
                  Ara_mean = mean (Aragonite_Sat_W , na.rm = T),
                  Ara_sd = sd (Aragonite_Sat_W , na.rm = T),
                  n = n())

Month_Stats<-Month_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
Month_Stats
```

## - Month Plots 

```{r}
Month_ploth<- ggplot(FLK.data) +
        MyTheme +  
        facet_grid(Zone~Sub_region)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank() )

Year_ploth<- ggplot(Month_Stats) +
        MyTheme +  
        theme(axis.title.x = element_blank())+
        Season_fill+
        Season_colour+
        facet_grid(Zone~Region)
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        #theme(axis.title.x = element_blank() )
```

### Temperature

```{r, echo=FALSE, fig.height=8, fig.width=8}
Temperature_month<- Month_ploth+
   geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
   scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 4),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=Temperature_C))+
    
    geom_point(data=FLK.data, aes (x=Month, y=Temperature_C, 
                                 shape=Extreme, fill=Precipitation), 
             alpha=0.8, size=1)
#Temperature_month

Tem_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),  
                       expand = c(0.1, 0.1)) +
    geom_point(aes (x=Sub_region, y=Tem_mean, fill=Season), 
             shape=21, alpha=0.5, size=1)+
  
    geom_boxplot(aes (x=Sub_region, y=Tem_mean))
    #stat_summary(aes (x=Sub_region, y=Tem_mean, colour=Season),
                #fun.data = "mean_cl_boot",geom = "errorbar",
                #width = 1, position=position_dodge(width=0.25))+
    #stat_summary(aes (x=Sub_region, y=Tem_mean, colour=Season),
                #fun.data = "mean_cl_boot", geom = "point", 
                #position=position_dodge(width=0.25))
#Tem_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
Temperature_my<-ggarrange(Temperature_month, Tem_Y,
          labels = c("(A)", "(B)"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Temperature_my
```

**Figure Supp 2:** Temperature variation by the region and shelf position by (A) month of the year and (B) season.   


### Salinity

```{r, echo=FALSE, fig.height=8, fig.width=8}
Sal_month<- Month_ploth+
   geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
   scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 2),  
                       expand = c(0.05, 0.05)) +
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=BestSalinity))+
  
    # annotate("point",
    #        x = c(1, 4, 7, 10),
    #        y = min(FLK.data$BestSalinity))+ 

    geom_point(data=FLK.data, aes (x=Month, y=BestSalinity, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#Sal_month

Sal_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 1),  
                       expand = c(0.05, 0.05)) +
  
    geom_boxplot(aes (x=Sub_region, y=Sal_mean))+
    
    geom_point(aes (x=Sub_region, y=Sal_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#Sal_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
Sal_my<-ggarrange(Sal_month, Sal_Y,
        labels = c("(A)", "(B)"),
        ncol = 2, nrow = 1, widths = c(4, 1.5))
Sal_my
```

**Figure Supp 3:** Salinity variation by the region and shelf position by (A) month of the year and (B) season. 

### TA

```{r, echo=FALSE, fig.height=8, fig.width=8}
TA_month<- Month_ploth+
   geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=TA_umol_kg))+
    
    geom_point(data=FLK.data, aes (x=Month, y=TA_umol_kg, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#TA_month

TA_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=TA_mean))+
    
    geom_point(aes (x=Sub_region, y=TA_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#TA_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
TA_my<-ggarrange(TA_month, TA_Y,
          labels = c("(A)", "(B)"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
TA_my
```

**Figure Supp 4:** Total Alkalinity (TA) variation by the region and shelf position by (A) month of the year and (B) season. 

### nTA

```{r, echo=FALSE, fig.height=8, fig.width=8}
nTA_month<- Month_ploth+
     geom_abline(slope = 0, intercept = mean_Op$OnTA, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=n35TA))+
    
    geom_point(data=FLK.data, aes (x=Month, y=n35TA, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#nTA_month

nTA_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OnTA, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=nTA_mean))+
    
    geom_point(aes (x=Sub_region, y=nTA_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#nTA_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
nTA_my<-ggarrange(nTA_month, nTA_Y,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
nTA_my
```

### DIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
DIC_month<- Month_ploth+
    geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=DIC_umol_kg))+
    
    geom_point(data=FLK.data, aes (x=Month, y=DIC_umol_kg, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#DIC_month

DIC_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=DIC_mean))+
    
    geom_point(aes (x=Sub_region, y=DIC_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#DIC_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
DIC_my<-ggarrange(DIC_month, DIC_Y,
          labels = c("(A)", "(B)"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
DIC_my
```

**Figure Supp 5:** Disolved Inorganic Carbon (DIC) variation by the region and shelf position by (A) month of the year and (B) season.

### nDIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
nDIC_month<- Month_ploth+
     geom_abline(slope = 0, intercept = mean_Op$OnDIC, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=n35DIC))+
    
    geom_point(data=FLK.data, aes (x=Month, y=n35DIC, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#nDIC_month

nDIC_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OnDIC, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=nDIC_mean))+
    
    geom_point(aes (x=Sub_region, y=nDIC_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#nDIC_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
nDIC_my<-ggarrange(nDIC_month, nDIC_Y,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
nDIC_my
```

### pCO2

```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_month<- Month_ploth+
     geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
  scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(200, 600, 100),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=pCO2_uatm))+
    
    geom_point(data=FLK.data, aes (x=Month, y=pCO2_uatm, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pCO2_month

pCO2_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(200, 600, 100),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Sub_region, y=pCO2_mean))+
    
    geom_point(aes (x=Sub_region, y=pCO2_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#pCO2_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_my<-ggarrange(pCO2_month, pCO2_Y,
         labels = c("(A)", "(B)"),
         ncol = 2, nrow = 1, widths = c(4, 1.5))
pCO2_my
```

**Figure Supp 6:** pCO2 variation by the region and shelf position by (A) month of the year and (B) season.

### pH

```{r, echo=FALSE, fig.height=8, fig.width=8}
pH_month<- Month_ploth +
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("pH")),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=pH_calculated))+
    
    geom_point(data=FLK.data, aes (x=Month, y=pH_calculated, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pH_month

pH_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("pH")),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Sub_region, y=pH_mean))+
    
    geom_point(aes (x=Sub_region, y=pH_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#pH_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
pH_my<-ggarrange(pH_month, pH_Y,
        labels = c("(A)", "(B)"),
        ncol = 2, nrow = 1, widths = c(4, 1.5))
pH_my
```

**Figure Supp 7:** pH variation by the region and shelf position by (A) month of the year and (B) season.


### Omega

```{r, echo=FALSE, fig.height=8, fig.width=8}
Omega_month<- Month_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite saturation state "(~Omega[ar]))),
                       breaks = seq(1, 5, 1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month, y=Aragonite_Sat_W))+
    geom_point(data=FLK.data, aes (x=Month, y=Aragonite_Sat_W, 
                fill=Precipitation, shape=Extreme), 
                alpha=0.8, size=1)
#Omega_month

Omega_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OAra , color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite saturation state "(~Omega[ar]))),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Sub_region, y=Ara_mean))+
    
    geom_point(aes (x=Sub_region, y=Ara_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#Omega_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
Ara_my<-ggarrange(Omega_month, Omega_Y,
          labels = c("(A)", "(B)"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Ara_my
```

**Figure Supp 8:** Omega variation by the region and shelf position by (A) month of the year and (B) season.


## 5.2 Season raw values 

## - Season stats (all data)

```{r}
Seasonal_Stats<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season),
             summarise,

      Tem_mean = mean (Temperature_C, na.rm = T),
      Tem_sd = sd (Temperature_C, na.rm = T),
    
      Sal_mean = mean (BestSalinity, na.rm = T),
      Sal_sd = sd (BestSalinity, na.rm = T),
    
      TA_mean = mean (TA_umol_kg, na.rm = T),
      TA_sd = sd (TA_umol_kg, na.rm = T),
    
      nTA_mean = mean (n35TA, na.rm = T),
      nTA_sd = sd (n35TA, na.rm = T),
    
      nDIC_mean = mean (n35DIC, na.rm = T),
      nDIC_sd = sd (n35DIC, na.rm = T),
    
      DIC_mean = mean (DIC_umol_kg, na.rm = T),
      DIC_sd = sd (DIC_umol_kg, na.rm = T),
    
      pCO2_mean = mean (pCO2_uatm , na.rm = T),
      pCO2_sd = sd (pCO2_uatm , na.rm = T),
    
      pH_mean = mean (pH_calculated, na.rm = T),
      pH_sd = sd (pH_calculated, na.rm = T),
    
      Ara_mean = mean (Aragonite_Sat_W , na.rm = T),
      Ara_sd = sd (Aragonite_Sat_W , na.rm = T),
       n())

Seasonal_Stats<-Seasonal_Stats %>% 
 mutate_if(is.numeric, round, digits=2)
Seasonal_Stats
```

## - Season stats (monthly mean)

```{r}
Seasonal_Stats2<- ddply (Month_Stats, .(Zone, Sub_region, Season),
                         summarise,

                  Tem_M = mean (Tem_mean, na.rm = T),
                  Tem_sd = sd (Tem_mean, na.rm = T),

                  Sal_M = mean (Sal_mean, na.rm = T),
                  Sal_sd = sd (Sal_mean, na.rm = T),

                  TA_M = mean (TA_mean, na.rm = T),
                  TA_sd = sd (TA_mean, na.rm = T),

                  nTA_M = mean (nTA_mean, na.rm = T),
                  nTA_sd = sd (nTA_mean, na.rm = T),

                  nDIC_M = mean (nDIC_mean, na.rm = T),
                  nDIC_sd = sd (nDIC_mean, na.rm = T),

                  DIC_M = mean (DIC_mean, na.rm = T),
                  DIC_sd = sd (DIC_mean, na.rm = T),

                  pCO2_M = mean (pCO2_mean , na.rm = T),
                  pCO2_sd = sd (pCO2_mean , na.rm = T),

                  pH_M = mean (pH_mean, na.rm = T),
                  pH_sd = sd (pH_mean, na.rm = T),

                  Ara_M = mean (Ara_mean , na.rm = T),
                  Ara_sd = sd (Ara_mean , na.rm = T),
                  n())

Seasonal_Stats2<-Seasonal_Stats2 %>% 
 mutate_if(is.numeric, round, digits=2)
Seasonal_Stats2

```

**Note:** SD is NA when calculating it based on monthly meand (n=3 per season)

## - Yearly stats (monthly mean)

```{r}
Yearly_Stats<- ddply (Month_Stats, .(Zone, Sub_region),
                         summarise,

                  Tem_Y = mean (Tem_mean, na.rm = T),
                  Tem_sd = sd (Tem_mean, na.rm = T),

                  Sal_Y = mean (Sal_mean, na.rm = T),
                  Sal_sd = sd (Sal_mean, na.rm = T),

                  TA_Y = mean (TA_mean, na.rm = T),
                  TA_sd = sd (TA_mean, na.rm = T),

                  nTA_Y = mean (nTA_mean, na.rm = T),
                  nTA_sd = sd (nTA_mean, na.rm = T),

                  nDIC_Y = mean (nDIC_mean, na.rm = T),
                  nDIC_sd = sd (nDIC_mean, na.rm = T),

                  DIC_Y = mean (DIC_mean, na.rm = T),
                  DIC_sd = sd (DIC_mean, na.rm = T),

                  pCO2_Y = mean (pCO2_mean , na.rm = T),
                  pCO2_sd = sd (pCO2_mean , na.rm = T),

                  pH_Y = mean (pH_mean, na.rm = T),
                  pH_sd = sd (pH_mean, na.rm = T),

                  Ara_Y = mean (Ara_mean , na.rm = T),
                  Ara_sd = sd (Ara_mean , na.rm = T),
                  n())

Yearly_Stats<-Yearly_Stats %>% 
 mutate_if(is.numeric, round, digits=2)
Yearly_Stats

```

**Note:** SD is NA when calculating it based on monthly meand (n=3 per season)
## - Season plots (all data)

```{r}
Season_plot<- ggplot(FLK.data) +
        MyTheme +  
        facet_grid(Zone~Season)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank())

par(mfrow=c(1,2))
```

### Temperature

```{r, echo=FALSE, fig.height=6, fig.width=4}
Temperature_season<- Season_plot+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 4),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region , y=Temperature_C))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=Temperature_C, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8)
Temperature_season
```

### Salinity

```{r, echo=FALSE, fig.height=6, fig.width=4}
Sal_season<- Season_plot+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 2),  
                       expand = c(0.05, 0.05)) +
    geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=BestSalinity))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=BestSalinity, 
                                 fill=Precipitation, shape=Extreme), 
            alpha=0.5, size=0.8)
Sal_season
```

### TA

```{r, echo=FALSE, fig.height=6, fig.width=4}
TA_season<- Season_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
    geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=TA_umol_kg))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=TA_umol_kg, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8)
TA_season
```

### n35TA

```{r, echo=FALSE, fig.height=6, fig.width=4}
nTA_season<- Season_plot+
 
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nTA (", mu, "mol ", kg^-1, ")")))+
    geom_abline(slope = 0, intercept = mean_Op$OnTA, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=n35TA))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=n35TA, 
                    fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8)
nTA_season
```

### DIC

```{r, echo=FALSE, fig.height=6, fig.width=4}
DIC_season<- Season_plot+
    scale_y_continuous(#limits = c(1700,2900),
                    expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
    geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=DIC_umol_kg))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=DIC_umol_kg, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8)

DIC_season
```

### nDIC

```{r, echo=FALSE, fig.height=6, fig.width=4}
nDIC_season<- Season_plot+
 
   scale_y_continuous(#limits = c(1700,2900),
                      expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nDIC (", mu, "mol ", kg^-1, ")")))+
    geom_abline(slope = 0, intercept = mean_Op$OnDIC, color="grey")+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=n35DIC))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=n35DIC, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8)
nDIC_season
```

### pCO2

```{r, echo=FALSE, fig.height=6, fig.width=4}
pCO2_season<- Season_plot+
   scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], "(", mu, " atm)")),
                       breaks = seq(200, 700, 100),
                        expand = c(0.05, 0.05)
                        ) +
    geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=pCO2_uatm))+
    geom_point(data=FLK.data, aes (x=Sub_region, y=pCO2_uatm, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8)
pCO2_season
```

### pH

```{r, echo=FALSE, fig.height=6, fig.width=4}
pH_season<- Season_plot+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("pH")),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=pH_calculated))+
    
    geom_point(data=FLK.data, aes (x=Sub_region, y=pH_calculated, 
                                 fill=Precipitation, shape=Extreme), 
            alpha=0.5, size=0.8)
pH_season
```

### Omega

```{r, echo=FALSE, fig.height=6, fig.width=4}
Omega_season<- Season_plot+
   scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite saturation state "~(Omega[ar]))),
                       breaks = seq(1, 5, 1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=Aragonite_Sat_W))+
    geom_point(data=FLK.data, aes (x=Sub_region, y=Aragonite_Sat_W, 
                fill=Precipitation, shape=Extreme), 
                alpha=0.5, size=0.8)
Omega_season
```

```{r}
par(mfrow=c(1,1))
```

## 5.3 Delta months values 

```{r}
# 1. Get the oceanic mean values per month-year 

  WS.reef<-join(WS.reef, mean_Open_MY, 
                 type = "left", by=c("MY", "Month"))

# 2. and subtract them from the reef data
  # Delta TA
  WS.reef$dTA_MY<-WS.reef$TA_umol_kg-WS.reef$OTA_my
  # Delta DIC
  WS.reef$dDIC_MY<-WS.reef$DIC_umol_kg-WS.reef$ODIC_my
  # Delta nTA
  WS.reef$dnTA_MY<-WS.reef$n35TA-WS.reef$OnTA_my
  # Delta nDIC
  WS.reef$dnDIC_MY<-WS.reef$n35DIC-WS.reef$OnDIC_my
  # Delta pCO2
  WS.reef$dpCO2_MY<-WS.reef$pCO2_uatm-WS.reef$OpCO2_O
  # Delta pH
  WS.reef$dpH_MY<-WS.reef$pH_calculated-WS.reef$OpH_O
   # Delta Omega
  WS.reef$dOme_MY<-WS.reef$Aragonite_Sat_W-WS.reef$OAra_O
  
 # head(WS.reef)
 #summary(WS.reef, digits=2)
```


## - Delta month stats 

```{r}
dMonth_Stats<- ddply (WS.reef, .(Zone, Sub_region, Month, Season, Region),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  
                  dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = mean (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = mean (dOme_MY , na.rm = T)
                  )

Year_Add<- ddply (dMonth_Stats, .(Zone, Sub_region, Region),
           summarise,
  dTA_Y = sum (dTA_mean, na.rm = T),
  dnTA_Y = sum (dnTA_mean, na.rm = T),
  dDIC_Y = sum (dDIC_mean, na.rm = T),
  dnDIC_Y = sum (dnDIC_mean, na.rm = T),
  dpCO2_Y = sum (dpCO2_mean, na.rm = T),
  dpH_Y = sum (dpH_mean, na.rm = T),
  dAra_Y = sum (dAra_mean, na.rm = T),
  
  mTA_Y = mean (dTA_mean, na.rm = T),
  mdTA_Y = median (dTA_mean, na.rm = T),
  mnTA_Y = mean (dnTA_mean, na.rm = T),
  mDIC_Y = mean (dDIC_mean, na.rm = T),
  mnDIC_Y = mean (dnDIC_mean, na.rm = T),
  mpCO2_Y = mean (dpCO2_mean, na.rm = T),
  mpH_Y = mean (dpH_mean, na.rm = T),
  mAra_Y = mean (dAra_mean, na.rm = T))

dMonth_Stats<-dMonth_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dMonth_Stats

Year_Add<-Year_Add %>% 
 mutate_if(is.numeric, round, digits=3)
Year_Add

Spring.data<-WS.reef[WS.reef$Season=="Spring", ]
Summer.data<-WS.reef[WS.reef$Season=="Summer", ]
Fall.data<-WS.reef[WS.reef$Season=="Fall", ]
Winter.data<-WS.reef[WS.reef$Season=="Winter", ]
```

## - Delta month plots

```{r}
Delta_plot<- ggplot(WS.reef) +
        MyTheme +  
        facet_grid(Zone~Sub_region)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank())

DeltaYear_plot<- ggplot(dMonth_Stats) +
        MyTheme +  
        facet_grid(Zone~Region)+
        Season_fill+
        Season_colour+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank())
        

Frequency_plot<- ggplot(data = WS.reef) +
      geom_vline(aes(xintercept = 0), linetype = "dashed")+
      facet_grid(Zone~Sub_region, scales = "free_y")+ MyTheme

```

### dTA

```{r, echo=FALSE, fig.height=8, fig.width=8}
TA_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dTA_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#TA_delta_m

TA_delta_Y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))+
    #geom_boxplot(data=dMonth_Stats, 
    #             aes (x=Sub_region, y=dTA_mean))+
    
    # geom_point( aes (x=Sub_region, y=dTA_mean, fill=Season),
    #             position=position_dodge(width=0.2),
    #             alpha=0.5, size=1, shape=21)+
    # 
    stat_summary(aes (x=Sub_region, y=dTA_mean, fill=Season),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Sub_region, y=dTA_mean, colour=Season),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2,
                position=position_dodge(width=0.8))+
    
    stat_summary(aes (x=Sub_region, y=dTA_mean),
                fun.data = "mean_cl_boot", geom = "point", size=3)+
    stat_summary(aes (x=Sub_region, y=dTA_mean),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
  
#TA_delta_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
dTA_my<-ggarrange(TA_delta_m, TA_delta_Y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dTA_my
```


### dTA density

```{r}
TA_freq_All<- Frequency_plot+
  geom_histogram(aes(x=dTA_MY, fill=Precipitation),
                alpha=0.8,
                binwidth = 25,
                position = "stack", colour="black")+
  geom_density(aes (dTA_MY), fill = "lightgray", alpha=0.4) +
  scale_x_continuous(# limits = c(1600, 2600),
                      breaks = seq(-300, 300, 100),
                      expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))
TA_freq_All


TA_freq_pre<- Frequency_plot+
  geom_density(aes (dTA_MY, fill = Precipitation), alpha = 0.4) +
  scale_x_continuous(breaks = seq(-300, 300, 100),
                     expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))
TA_freq_pre

# TA_freq_sea<- Frequency_plot+
#   geom_density(aes (dTA_MY, fill = Season), alpha = 0.4) +
#   scale_x_continuous(breaks = seq(-300, 300, 100),
#                      expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))
# TA_freq_sea

```

### dnTA

```{r, echo=FALSE, fig.height=8, fig.width=8}
nTA_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 200),
                     name=expression(paste(Delta, " nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dnTA_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dnTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#nTA_delta_m

dnTA_delta_Y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "nTA (", mu, "mol ", kg^-1, ")")))+
    geom_boxplot(data=dMonth_Stats, 
                 aes (x=Sub_region, y=dnTA_mean))+
    geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dnTA_mean, fill=Season), 
             alpha=0.8, size=1.5, shape=21)
#dnTA_delta_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dnTA_my<-ggarrange(nTA_delta_m, dnTA_delta_Y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dnTA_my
```

### dDIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
DIC_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dDIC_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#DIC_delta_m

DIC_delta_Y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=dMonth_Stats, 
                 aes (x=Sub_region, y=dDIC_mean))+
    
    geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dDIC_mean, fill=Season), 
             alpha=0.8, size=1.5, shape=21)
#DIC_delta_Y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
dDIC_my<-ggarrange(DIC_delta_m, DIC_delta_Y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dDIC_my
```


### dDIC density

```{r}
dDIC_freq_All<- Frequency_plot+
  geom_density(aes (dDIC_MY), fill = "lightgray", alpha=0.5) +
  scale_x_continuous(breaks = seq(-300, 300, 100),
                     expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))
dDIC_freq_All

dDIC_freq_pre<- Frequency_plot+
  geom_density(aes (dDIC_MY, fill = Precipitation),
               alpha = 0.4) +
  scale_x_continuous(breaks = seq(-300, 300, 100),
                    expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))
dDIC_freq_pre

# dDIC_freq_sea<- Frequency_plot+
#   geom_density(aes (dDIC_MY, fill = Season), alpha = 0.4) +
#   scale_x_continuous(breaks = seq(-300, 300, 100),
#                      expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))
# dDIC_freq_sea

```

### dnDIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
nDIC_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 200),
                     name=expression(paste(Delta, " nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dnDIC_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dnDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#nDIC_delta_m

dnDIC_delta_Y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, " nDIC (", mu, "mol ", kg^-1, ")")))+
    geom_boxplot(data=dMonth_Stats, 
                 aes (x=Sub_region, y=dnDIC_mean))+
    
    geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dnDIC_mean, fill=Season), 
             alpha=0.8, size=1.5, shape=21)
#dnDIC_delta_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dnDIC_my<-ggarrange(nDIC_delta_m, dnDIC_delta_Y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dnDIC_my
```

### dpCO2

```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste(Delta ~ pCO[2] , " (", mu, "atm)")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dpCO2_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dpCO2_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pCO2_delta_m

pCO2_delta_y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste(Delta ~ pCO[2] , " (", mu, "atm)")))+
  
    geom_boxplot(data=dMonth_Stats, 
                 aes (x=Sub_region, y=dpCO2_mean))+
    
    geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dpCO2_mean, fill=Season), 
             alpha=0.8, size=1.5, shape=21)
#pCO2_delta_y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dpCO2_my<-ggarrange(pCO2_delta_m, pCO2_delta_y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dpCO2_my
```


### dpH

```{r, echo=FALSE, fig.height=8, fig.width=8}
pH_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta, " pH"))),
                       breaks = seq(-5, 5, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dpH_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dpH_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pH_delta_m

pH_delta_y<- DeltaYear_plot+
     scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta, " pH"))),
                       breaks = seq(-5, 5, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=dMonth_Stats, 
                 aes (x=Sub_region, y=dpH_mean))+
    
    geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dpH_mean, fill=Season), 
             alpha=0.8, size=1.5, shape=21)
#pH_delta_y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dpH_my<-ggarrange(pH_delta_m, pH_delta_y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dpH_my
```

### dOmega

```{r, echo=FALSE, fig.height=8, fig.width=8}
Omega_delta_m<- Delta_plot+
   scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta, " Aragonite saturation state "
                                               ~(Omega[ar])))),
                       breaks = seq(-3, 3, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dOme_MY))+
    geom_point(data=WS.reef, aes (x=Month, y=dOme_MY, 
                fill=Precipitation, shape=Extreme), 
                alpha=0.8, size=1)
#Omega_delta_m

Omega_delta_y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta, " Aragonite saturation state "
                                              ~(Omega[ar])))),
                       breaks = seq(-3, 3, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=dMonth_Stats, 
                 aes (x=Sub_region, y=dAra_mean))+
    
    geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dAra_mean, fill=Season), 
             alpha=0.8, size=1.5, shape=21)
#Omega_delta_y
```


```{r, echo=FALSE, fig.height=8, fig.width=8}
dAra_my<-ggarrange(Omega_delta_m, Omega_delta_y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dAra_my
```


## 5.4 Delta season values 

## - Delta season stats 

```{r}
  dSeason_Stats<- ddply (WS.reef, .(Zone, Season, Sub_region),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  
                  dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = mean (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = mean (dOme_MY , na.rm = T)
                  )

dSeason_Stats<-dSeason_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dSeason_Stats
```

## - Delta season plots

```{r}
Delta_S_plot<- ggplot(WS.reef) +
        MyTheme +  
        facet_grid(Zone~Season)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank())
par(mfrow=c(1,2))
        
```

### TA

```{r, echo=FALSE, fig.height=6, fig.width=4}
TA_delta_S<- Delta_S_plot+
 
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta~"TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dTA_MY))+
    
    geom_point(data=WS.reef, aes (x=Sub_region, y=dTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
TA_delta_S
```

### nTA

```{r, echo=FALSE, fig.height=6, fig.width=4}
nTA_delta_S<- Delta_S_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta~"nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dnTA_MY))+
    
    geom_point(data=WS.reef, aes (x=Sub_region, y=dnTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
nTA_delta_S
```

### DIC

```{r, echo=FALSE, fig.height=6, fig.width=4}
DIC_delta_S<- Delta_S_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta~"DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dDIC_MY))+
    
    geom_point(data=WS.reef, aes (x=Sub_region, y=dDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
DIC_delta_S
```

### nDIC

```{r, echo=FALSE, fig.height=6, fig.width=4}
nDIC_delta_S<- Delta_S_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta~"nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dnDIC_MY))+
    
    geom_point(data=WS.reef, aes (x=Sub_region, y=dnDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
nDIC_delta_S
```

### pCO2

```{r, echo=FALSE, fig.height=6, fig.width=4}
pCO2_delta_S<- Delta_S_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                    breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta~pCO[2] , "(", mu, "atm) ")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dpCO2_MY))+
    
    geom_point(data=WS.reef, aes (x=Sub_region, y=dpCO2_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
pCO2_delta_S
```

### pH

```{r, echo=FALSE, fig.height=6, fig.width=4}
pH_delta_S<- Delta_S_plot+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta~"pH"))),
                       breaks = seq(-5, 5, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dpH_MY))+
    
    geom_point(data=WS.reef, aes (x=Sub_region, y=dpH_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
pH_delta_S
```

### Omega

```{r, echo=FALSE, fig.height=6, fig.width=4}
Omega_delta_S<- Delta_S_plot+
   scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta~"Aragonite saturation state "
                                               ~(Omega[ar])))),
                       breaks = seq(-3, 3, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dOme_MY))+
    geom_point(data=WS.reef, aes (x=Sub_region, y=dOme_MY, 
                fill=Precipitation, shape=Extreme), 
                alpha=0.8, size=1)
Omega_delta_S
```

```{r}
par(mfrow=c(1,1))
```


## 5.5 Month in the inshore reef data 

```{r}
Inshore.data<-WS.reef[WS.reef$Zone=="Inshore", ]
```

## - Month in the inshore reef stats 

```{r}
  dreef_Stats<- ddply (Inshore.data, .(Month, Sub_region, Region),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  
                  dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = mean (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = mean (dOme_MY , na.rm = T)
                  )
dreef_Stats<-dreef_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dreef_Stats
```

## - Month in the inshore reef figures

```{r}
library(viridis)
Final_plot<- ggplot(Inshore.data)+ 
        MyTheme + 
        theme(axis.title.x = element_blank())+
        facet_grid(~Sub_region)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))

Year_reef<- ggplot(Month_Stats[Month_Stats$Zone=="Inshore", ]) +
        MyTheme +  
        theme(axis.title.x = element_blank())+
        Season_fill+
        facet_grid(Zone~Region)
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+

dYear_reef<- ggplot(dMonth_Stats[dMonth_Stats$Zone=="Inshore", ]) +
        MyTheme +  
        theme(axis.title.x = element_blank())+
        facet_grid(Zone~Region)
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        
```

### Temperature

```{r, echo=FALSE, fig.height=4, fig.width=8}
Temperature_fig<- Final_plot+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 4),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=Temperature_C))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=Temperature_C, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = T)
#Temperature_fig

Tem_Y_fig<- Year_reef+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),  
                       expand = c(0.1, 0.1)) +
  
    geom_boxplot(aes (x=Sub_region, y=Tem_mean))+
    
    geom_point(aes (x=Sub_region, y=Tem_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = T)
#Tem_Y_fig
```


```{r, echo=FALSE, fig.height=4, fig.width=8}
Temperature_reef<-ggarrange(Temperature_fig, Tem_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Temperature_reef
```

### Salinity

```{r, echo=FALSE, fig.height=4, fig.width=8}
Sal_fig<- Final_plot+
       geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
       scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 2),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=BestSalinity))+
    geom_point(data=Inshore.data, aes (x=Month, y=BestSalinity, 
                                 fill=Precipitation, shape=Extreme), 
               show.legend = F, alpha=0.8, size=0.8)
#Sal_fig

Sal_Y_fig<- Year_reef+
    geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 1),  
                       expand = c(0.05, 0.05)) +
  
    geom_boxplot(aes (x=Sub_region, y=Sal_mean))+
    geom_point(aes (x=Sub_region, y=Sal_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#Sal_Y_fig
```


```{r, echo=FALSE, fig.height=4, fig.width=8}
Sal_reef<-ggarrange(Sal_fig, Sal_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Sal_reef
```

### Delta TA

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltaTA_fig<- Final_plot+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=dTA_MY))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=dTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
#DeltaTA_fig

dTA_Y_fig<- dYear_reef+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 50),
                     name=expression(paste(Delta, " TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=dTA_mean))+
    geom_point(aes (x=Sub_region, y=dTA_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#dTA_Y_fig
```

```{r, echo=FALSE, fig.height=4, fig.width=8}
dTA_reef<-ggarrange(DeltaTA_fig, dTA_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dTA_reef
```

### Delta nTA

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltanTA_fig<- Final_plot+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 150),
                     name=expression(paste(Delta, " nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=dnTA_MY))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=dnTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
#DeltanTA_fig

dnTA_Y_fig<- dYear_reef+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                       expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=dnTA_mean))+
    geom_point(aes (x=Sub_region, y=dnTA_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#dnTA_Y_fig
```

```{r, echo=FALSE, fig.height=4, fig.width=8}
dnTA_reef<-ggarrange(DeltanTA_fig, dnTA_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dnTA_reef
```

### Delta DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltaDIC_fig<- Final_plot+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                      expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 150),
                     name=expression(paste(Delta, " DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=dDIC_MY))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=dDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
#DeltaDIC_fig

dDIC_Y_fig<- dYear_reef+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                       expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=dDIC_mean))+
    geom_point(aes (x=Sub_region, y=dDIC_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#dDIC_Y_fig
```

```{r, echo=FALSE, fig.height=4, fig.width=8}
dDIC_reef<-ggarrange(DeltaDIC_fig, dDIC_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dDIC_reef
```

### nDelta DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltanDIC_fig<- Final_plot+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                       expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=dnDIC_MY))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=dnDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
#DeltanDIC_fig

dnDIC_Y_fig<- dYear_reef+
    geom_abline(slope = 0, intercept = mean_Op$OnDIC, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                      expand = c(0.05, 0.05),
                     breaks = seq(-500, 500, 50),
                     name=expression(paste(Delta, " nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Sub_region, y=dnDIC_mean))+
    geom_point(aes (x=Sub_region, y=dnDIC_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#dnDIC_Y_fig
```

```{r, echo=FALSE, fig.height=4, fig.width=8}
dnDIC_reef<-ggarrange(DeltanDIC_fig, dnDIC_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dnDIC_reef
```

### pCO2

```{r, echo=FALSE, fig.height=4, fig.width=8}
pCO2_fig<- Final_plot+
    geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], "(", mu, " atm)")),
                       breaks = seq(200, 700, 200),
                        expand = c(0.05, 0.05)
                        ) +
 
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=pCO2_uatm))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=pCO2_uatm, 
                                 fill=Precipitation, shape=Extreme), 
               show.legend = F, alpha=0.8, size=0.8)
#pCO2_fig

pCO2_Y_fig<- Year_reef+
    geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], "(", mu, " atm)")),
                       breaks = seq(200, 700, 100),
                        expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Sub_region, y=pCO2_mean))+
    geom_point(aes (x=Sub_region, y=pCO2_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#pCO2_Y_fig
```


```{r, echo=FALSE, fig.height=4, fig.width=8}
pCO2_reef<-ggarrange(pCO2_fig, pCO2_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
pCO2_reef
```

### pH

```{r, echo=FALSE, fig.height=4, fig.width=8}
pH_fig<- Final_plot+
  geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
  scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("pH")),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
  geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=pH_calculated))+
    
  geom_point(data=Inshore.data, aes (x=Month, y=pH_calculated, 
                                 fill=Precipitation, shape=Extreme), 
                              show.legend = F, alpha=0.8, size=0.8)
#pH_fig

pH_Y_fig<- Year_reef+
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("pH")),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    geom_boxplot(aes (x=Sub_region, y=pH_mean))+
    geom_point(aes (x=Sub_region, y=pH_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#pH_Y_fig
```


```{r, echo=FALSE, fig.height=4, fig.width=8}
pH_reef<-ggarrange(pH_fig, pH_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
pH_reef
```

### Omega

```{r, echo=FALSE, fig.height=4, fig.width=8}
Omega_fig<- Final_plot+
      geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
      scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite "~(Omega[ar]))),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Month, y=Aragonite_Sat_W))+
    
    geom_point(data=Inshore.data, aes (x=Month, y=Aragonite_Sat_W, 
                                 fill=Precipitation, shape=Extreme), 
               show.legend = F, alpha=0.8, size=0.8)
#Omega_fig

Omega_Y_fig<- Year_reef+
    geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite "~(Omega[ar]))),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(aes (x=Sub_region, y=Ara_mean))+
    geom_point(aes (x=Sub_region, y=Ara_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5,  show.legend = F)
#Omega_Y_fig
```


```{r, echo=FALSE, fig.height=4, fig.width=8}
Omega_reef<-ggarrange(Omega_fig, Omega_Y_fig,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Omega_reef
```

## - Month in the inshore reef figure 

```{r, echo=FALSE, fig.height=12, fig.width=8.5}
# Figure_monts<-ggarrange(DeltaTA_fig, DeltanTA_fig,
#                         DeltaDIC_fig, DeltanDIC_fig,
#                         pCO2_fig, Temperature_fig,
#                         pH_fig, Sal_fig,
#                         Omega_fig,
#                         
#           #labels = c("", ""),
#           ncol = 2, nrow = 5)
# Figure_monts

Figure_monts2<-ggarrange(dTA_reef, dDIC_reef,
                        #DeltaDIC_fig, DeltanDIC_fig,
                        pCO2_reef, pH_reef, Omega_reef,
                        #Temperature_fig, Sal_fig, Omega_fig,
                        
          #labels = c("", ""),
          ncol = 1)
Figure_monts2
```

## 5.6 Seasons in the inshore reefs data 

## - Season in the reef stats 

```{r}
  dreef_Stats<- ddply (Inshore.data, .(Season, Sub_region),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  
                  dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = mean (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = mean (dOme_MY , na.rm = T)
                  )
dreef_Stats<-dreef_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dreef_Stats
```

## - Season in the reef figures 

```{r}
Season_plot<- ggplot(Inshore.data)+ 
        MyTheme +  theme(axis.title.x = element_blank())+
        facet_grid(~Season)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))
```

### Temperature

```{r, echo=FALSE, fig.height=4, fig.width=8}
Temperature_sea_re<- Season_plot+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 4),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=Temperature_C))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=Temperature_C, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.5, size=0.8, show.legend = F, width = 0.20)
Temperature_sea_re

Tem_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),  
                       expand = c(0.1, 0.1)) +
  
    geom_boxplot(aes (x=Sub_region, y=Tem_mean))+
    
    geom_point(aes (x=Sub_region, y=Tem_mean, fill=Season), 
             shape=21, alpha=0.8, size=1)
#Tem_Y
```

### Salinity

```{r, echo=FALSE, fig.height=4, fig.width=8}
Sal_sea_re<- Season_plot+
      geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
      scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 2),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=BestSalinity))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=BestSalinity, 
                                 fill=Precipitation, shape=Extreme), 
               alpha=0.8, size=0.8, show.legend = F, width = 0.20)
Sal_sea_re
```

### Delta TA

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltaTA_sea_re<- Season_plot+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.02, 0.02),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dTA_MY))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=dTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
DeltaTA_sea_re
```

### Delta nTA

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltanTA_sea_re<- Season_plot+
    geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.02, 0.02),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dnTA_MY))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=dnTA_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
DeltanTA_sea_re
```

### Delta DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltaDIC_sea_re<- Season_plot+
  geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.02, 0.02),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dDIC_MY))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=dDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
DeltaDIC_sea_re
```

### Delta nDIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
DeltanDIC_sea_re<- Season_plot+
  geom_abline(slope = 0, intercept = 0, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.02, 0.02),
                     breaks = seq(-500, 500, 100),
                     name=expression(paste(Delta, " nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=dnDIC_MY))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=dnDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=0.8, show.legend = F)
DeltanDIC_sea_re
```

### pCO2

```{r, echo=FALSE, fig.height=4, fig.width=8}
pCO2_sea_re<- Season_plot+
      geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
       scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], "(", mu, " atm)")),
                       breaks = seq(200, 700, 100),
                        expand = c(0.05, 0.05)
                        ) +
 
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=pCO2_uatm))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=pCO2_uatm, 
                                 fill=Precipitation, shape=Extreme), 
               show.legend = F, alpha=0.8, size=0.8)
pCO2_sea_re
```

### pH

```{r, echo=FALSE, fig.height=4, fig.width=8}
pH_sea_re<- Season_plot+
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("pH")),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=pH_calculated))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=pH_calculated, 
                                 fill=Precipitation, shape=Extreme), 
               show.legend = F, alpha=0.8, size=0.8)
pH_sea_re
```

### Omega

```{r, echo=FALSE, fig.height=4, fig.width=8}
Omega_sea_re<- Season_plot+
      geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
          scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite "~(Omega[ar]))),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=Inshore.data[Inshore.data$Extreme=="Normal", ], 
                 aes (x=Sub_region, y=Aragonite_Sat_W))+
    
    geom_point(data=Inshore.data, aes (x=Sub_region, y=Aragonite_Sat_W, 
                                 fill=Precipitation, shape=Extreme), 
               show.legend = F, alpha=0.8, size=0.8)
Omega_sea_re
```

## - Seasons in the reef figure 

```{r, echo=FALSE, fig.height=8.8, fig.width=8.8}
Figure_sea_re<-ggarrange(DeltaTA_sea_re, DeltanTA_sea_re,
                         DeltaDIC_sea_re, DeltanDIC_sea_re, 
                         pH_sea_re, pCO2_sea_re, 
                         Temperature_sea_re, Sal_sea_re, 
                         Omega_sea_re,
                        
          #labels = c("", ""),
          ncol = 2, nrow = 5)
Figure_sea_re
```

```{r, echo=FALSE, fig.height=8, fig.width=8.8}
Figure_sea_re2<-ggarrange(
  DeltaTA_sea_re, DeltaDIC_sea_re,Omega_sea_re, 
  DeltanTA_sea_re, DeltanDIC_sea_re, pCO2_sea_re, 
  Temperature_sea_re, Sal_sea_re,  pH_sea_re,
                        
          #labels = c("", ""),
          ncol = 3, nrow = 3)
Figure_sea_re2
```

## 5.7 Seasoal models

```{r}
season.data<-WS.reef[WS.reef$Extreme=="Normal", ]
season.data<-droplevels(season.data)
season.data$Zone<-factor(season.data$Zone, levels = c("Offshore", "Mid channel", "Inshore"))
summary(season.data)

inshore.season.data<-season.data[season.data$Zone=="Inshore", ]
midchanel.season.data<-season.data[season.data$Zone=="Mid channel", ]
ofshore.season.data<-season.data[season.data$Zone=="Offshore", ]
```

### LMER - all dTA

```{r, fig.height=4, fig.width=4}
  hist(season.data$dTA_MY)
  shapiro.test(season.data$dTA_MY) # Normality rejected
# 
#   dTA_seson<-lmer(dTA_MY~  Zone + Sub_region + Season +
#                            Zone:Sub_region + Zone:Season + Sub_region:Season+   
#                            (1|SiteID), data=season.data)
  
  dTA_seson<-lmer(dTA_MY~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dTA_seson)    
  av.dTA_seson<-(anova(dTA_seson))
  av.dTA_seson
  ranova(dTA_seson)
  #step(dTA_seson)
  
  plot(dTA_seson)
  qqnorm(resid(dTA_seson))
  acf(resid(dTA_seson), main="acf(resid(dTA Season))")
  
  #summ(dTA_seson, scale = TRUE)
  plot_summs(dTA_seson)
  
  dTA_ses.emmc<-emmeans(dTA_seson, ~Zone*Sub_region*Season)
    dTA_ses.emmc<-multcomp::cld(dTA_ses.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dTA_ses.emmc<-dTA_ses.emmc[order(dTA_ses.emmc$Zone, dTA_ses.emmc$Season), ]
  dTA_ses.emmc
  
```
 
### LMER - dTA Inshore 
 
```{r}
# Inshore dTA
  hist(inshore.season.data$dTA_MY)
  shapiro.test(inshore.season.data$dTA_MY) # Normality rejected

  dTA_seson_in<-lmer(dTA_MY~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
  #summary(dTA_seson_in)    
  av.dTA_seson_in<-anova(dTA_seson_in)
  av.dTA_seson_in
  ranova(dTA_seson_in)
  #step(dTA_seson_in)
  
  plot(dTA_seson_in)
  qqnorm(resid(dTA_seson_in))
  acf(resid(dTA_seson_in), main="acf(resid(dTA Season))")
  
  #summ(dTA_seson_in, scale = TRUE)
  plot_summs(dTA_seson_in)
  
  dTA_ses_in.emmc<-emmeans(dTA_seson_in, ~ Sub_region*Season)
    dTA_ses_in.emmc<-multcomp::cld(dTA_ses_in.emmc)
    #dTA_ses_in.emmc<-as.data.frame(dTA_ses_in.emmc[complete.cases(dTA_ses_in.emmc),])
    dTA_ses_in.emmc<-dTA_ses_in.emmc[order(dTA_ses_in.emmc$Season,
                                           dTA_ses_in.emmc$Sub_region), ]
  dTA_ses_in.emmc
```


### LMER - all dDIC

```{r, fig.height=4, fig.width=4}
# Inshore Omega
  hist(season.data$dDIC_MY)
  shapiro.test(season.data$dDIC_MY) # Normality rejected

  # dDIC_seson<-lmer(dDIC_MY~ Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  
  dDIC_seson<-lmer(dDIC_MY~ Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dDIC_seson)    
  av.dDIC_seson<-anova(dDIC_seson)
  av.dDIC_seson
  ranova(dDIC_seson)
  step(dDIC_seson)
  
  plot(dDIC_seson)
  qqnorm(resid(dDIC_seson))
  acf(resid(dDIC_seson), main="acf(resid(dTA Season))")
  
  #summ(dDIC_seson, scale = TRUE)
  plot_summs(dDIC_seson)
  
  dDIC_ses.emmc<-emmeans(dDIC_seson, ~Zone*Sub_region*Season)
    dDIC_ses.emmc<-multcomp::cld(dDIC_ses.emmc)
    dDIC_ses.emmc<-dDIC_ses.emmc[order(dDIC_ses.emmc$Zone, dDIC_ses.emmc$Season), ]
  dDIC_ses.emmc

```

### LMER - dDIC Inshore 
 
```{r}
# Inshore dDIC
  hist(inshore.season.data$dDIC_MY)
  shapiro.test(inshore.season.data$dDIC_MY) # Normality rejected

  dDIC_seson_in<-lmer(dDIC_MY~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
  #summary(dDIC_seson_in)    
  av.dDIC_seson_in<-anova(dDIC_seson_in)
  av.dDIC_seson_in
  ranova(dDIC_seson_in)
  #step(dDIC_seson_in)
  
  plot(dDIC_seson_in)
  qqnorm(resid(dDIC_seson_in))
  acf(resid(dDIC_seson_in), main="acf(resid(dTA Season))")
  
  #summ(dDIC_seson_in, scale = TRUE)
  plot_summs(dDIC_seson_in)
  
  dDIC_ses_in.emmc<-emmeans(dDIC_seson_in, ~ Sub_region*Season)
    dDIC_ses_in.emmc<-multcomp::cld(dDIC_ses_in.emmc)
    #dDIC_ses_in.emmc<-as.data.frame(dDIC_ses_in.emmc[complete.cases(dDIC_ses_in.emmc),])
    dDIC_ses_in.emmc<-dDIC_ses_in.emmc[order(dDIC_ses_in.emmc$Season,
                                           dDIC_ses_in.emmc$Sub_region), ]
  dDIC_ses_in.emmc
```

### LMER - all dpCO2

```{r, fig.height=4, fig.width=4}
# Inshore Omega
  hist(season.data$dpCO2_MY)
  shapiro.test(season.data$dpCO2_MY) # Normality rejected

  # dpCO2_seson<-lmer(dpCO2_MY~ Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  dpCO2_seson<-lmer(dpCO2_MY~ Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dpCO2_seson)    
  av.dPCO2_seson<-anova(dpCO2_seson)
  av.dPCO2_seson
  ranova(dpCO2_seson)
  step(dpCO2_seson)
  
  plot(dpCO2_seson)
  qqnorm(resid(dpCO2_seson))
  acf(resid(dpCO2_seson), main="acf(resid(dTA Season))")

  plot_summs(dpCO2_seson)  
  
  dpCO2_ses.emmc<-emmeans(dpCO2_seson, ~Zone*Sub_region*Season)
    dpCO2_ses.emmc<-multcomp::cld(dpCO2_ses.emmc)
    #dpCO2_ses.emmc<-as.data.frame(dpCO2_ses.emmc[complete.cases(dpCO2_ses.emmc),])
    dpCO2_ses.emmc<-dpCO2_ses.emmc[order(dpCO2_ses.emmc$Zone, dpCO2_ses.emmc$Season), ]
  dpCO2_ses.emmc
  #summ(dpCO2_seson, scale = TRUE)
```

### LMER - dPCO2 Inshore 
 
```{r}
# Inshore dDIC
  hist(inshore.season.data$dpCO2_MY)
  shapiro.test(inshore.season.data$dpCO2_MY) # Normality rejected

  dpCO2_seson_in<-lmer(dpCO2_MY~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
  #summary(dpCO2_seson_in)    
  av.dPCO2_seson_in<-anova(dpCO2_seson_in)
  av.dPCO2_seson_in
  ranova(dpCO2_seson_in)
  #step(dpCO2_seson_in)
  
  plot(dpCO2_seson_in)
  qqnorm(resid(dpCO2_seson_in))
  acf(resid(dpCO2_seson_in), main="acf(resid(dTA Season))")
  
  #summ(dpCO2_seson_in, scale = TRUE)
  plot_summs(dpCO2_seson_in)
  
  dpCO2_ses_in.emmc<-emmeans(dpCO2_seson_in, ~ Sub_region*Season)
    dpCO2_ses_in.emmc<-multcomp::cld(dpCO2_ses_in.emmc)
    #dpCO2_ses_in.emmc<-as.data.frame(dpCO2_ses_in.emmc[complete.cases(dpCO2_ses_in.emmc),])
    dpCO2_ses_in.emmc<-dpCO2_ses_in.emmc[order(dpCO2_ses_in.emmc$Season,
                                           dpCO2_ses_in.emmc$Sub_region), ]
  dpCO2_ses_in.emmc
```

### LMER - all Omega

```{r, fig.height=4, fig.width=4}
# Inshore Omega
  hist(season.data$Aragonite_Sat_W)
  shapiro.test(season.data$Aragonite_Sat_W) # Normality rejected

  # Omega_seson<-lmer(Aragonite_Sat_W~  Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  Omega_seson<-lmer(Aragonite_Sat_W~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(Omega_seson)    
  av.Ome_seson<-anova(Omega_seson)
  av.Ome_seson
  ranova(Omega_seson)
  #step(Omega_seson)
  
  plot(Omega_seson)
  qqnorm(resid(Omega_seson))
  acf(resid(Omega_seson), main="acf(resid(dTA Season))")
  
  plot_summs(Omega_seson)  
    
  Ara_ses.emmc<-emmeans(Omega_seson, ~Zone*Sub_region*Season)
    Ara_ses.emmc<-multcomp::cld(Ara_ses.emmc)
    Ara_ses.emmc<-as.data.frame(Ara_ses.emmc[complete.cases(Ara_ses.emmc),])
    Ara_ses.emmc<-Ara_ses.emmc[order(Ara_ses.emmc$Zone, Ara_ses.emmc$Season), ]
  Ara_ses.emmc
```

### LMER - Omega Inshore 
 
```{r}
# Inshore dDIC
  hist(inshore.season.data$Aragonite_Sat_W)
  shapiro.test(inshore.season.data$Aragonite_Sat_W) # Normality rejected

  Omega_seson_in<-lmer(Aragonite_Sat_W~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
      #summary(Omega_seson_in)    
      av.Ome_seson_in<-anova(Omega_seson_in)
      av.Ome_seson_in
      ranova(Omega_seson_in)
      #step(Omega_seson_in)
      
      plot(Omega_seson_in)
      qqnorm(resid(Omega_seson_in))
      acf(resid(Omega_seson_in), main="acf(resid(dTA Season))")
      
      #summ(dDIC_seson_in, scale = TRUE)
  plot_summs(Omega_seson_in)
  
  omega_ses_in.emmc<-emmeans(Omega_seson_in, ~ Sub_region*Season)
    omega_ses_in.emmc<-multcomp::cld(omega_ses_in.emmc)
    #omega_ses_in.emmc<-as.data.frame(omega_ses_in.emmc[complete.cases(omega_ses_in.emmc),])
    omega_ses_in.emmc<-omega_ses_in.emmc[order(omega_ses_in.emmc$Season,
                                           omega_ses_in.emmc$Sub_region), ]
  omega_ses_in.emmc
```

### LMER - all pH

```{r, fig.height=4, fig.width=4}
# Inshore Omega
  hist(season.data$pH_calculated)
  shapiro.test(season.data$pH_calculated) # Normality rejected

  # pH_seson<-lmer(pH_calculated~ Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  pH_seson<-lmer(pH_calculated~ Zone * Sub_region * Season *
                           (1|SiteID), data=season.data)
  
        #summary(pH_seson)    
        av.pH_seson<-anova(pH_seson)
        av.pH_seson
        ranova(pH_seson)
        #step(pH_seson)
        
        plot(pH_seson)
        qqnorm(resid(pH_seson))
        acf(resid(pH_seson), main="acf(resid(dTA Season))")
      
  #summ(pH_seson, scale = TRUE)
  plot_summs(pH_seson)  
  
  pH_ses.emmc<-emmeans(pH_seson, ~Zone*Sub_region*Season)
    pH_ses.emmc<-multcomp::cld(pH_ses.emmc)
    pH_ses.emmc<-as.data.frame(pH_ses.emmc[complete.cases(pH_ses.emmc),])
    pH_ses.emmc<-pH_ses.emmc[order(pH_ses.emmc$Zone, pH_ses.emmc$Season), ]
  pH_ses.emmc
```

### LMER - pH Inshore 
 
```{r}
# Inshore pH
  hist(inshore.season.data$pH_calculated)
  shapiro.test(inshore.season.data$pH_calculated) # Normality rejected

  pH_seson_in<-lmer(pH_calculated~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
    #summary(pH_seson_in)    
    av.pH_seson_in<-anova(pH_seson_in)
    av.pH_seson_in
    ranova(pH_seson_in)
    #step(pH_seson_in)
    
    plot(pH_seson_in)
    qqnorm(resid(pH_seson_in))
    acf(resid(pH_seson_in), main="acf(resid(dTA Season))")
    
    #summ(pH_seson_in, scale = TRUE)
    plot_summs(pH_seson_in)
  
  pH_ses_in.emmc<-emmeans(pH_seson_in, ~ Sub_region*Season)
    pH_ses_in.emmc<-multcomp::cld(pH_ses_in.emmc)
    #pH_ses_in.emmc<-as.data.frame(pH_ses_in.emmc[complete.cases(pH_ses_in.emmc),])
    pH_ses_in.emmc<-pH_ses_in.emmc[order(pH_ses_in.emmc$Season,
                                           pH_ses_in.emmc$Sub_region), ]
  pH_ses_in.emmc
```

## Summary all data

```{r}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.dTA_seson <- data.frame(av.dTA_seson)
    av.dDIC_seson <- data.frame(av.dDIC_seson) 
    av.dPCO2_seson <- data.frame(av.dPCO2_seson)
    av.Ome_seson <- data.frame(av.Ome_seson) 
    av.pH_seson <- data.frame(av.pH_seson) 
    
    # Putting all into one dataframe/table
    anova_results_all <- data.frame(cbind
                    (c("Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season"), 
                                      rbind(av.dTA_seson, av.dDIC_seson, av.dPCO2_seson,
                                            av.Ome_seson, av.pH_seson ))) 
    colnames(anova_results_all) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_results_all) <- NULL
    
    # create HTML table using kableExtra
    anova_results_all %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "d TA", 1, 7) %>% # groups rows with label
      pack_rows(., "d DIC", 8, 14)  %>% # groups rows with label
      pack_rows(., "d pCO2", 15, 21) %>% # groups rows with label
      pack_rows(., "Omega", 22, 28)  %>% # groups rows with label
      pack_rows(., "pH", 29, 35)  
    
    
    
#export_summs(dTA_seson, dDIC_seson, dpCO2_seson,  scale = TRUE)
      
      Seasonal_models<-list("d TA" = dTA_seson, 
                         "d DIC" = dDIC_seson, 
                         "d pCO2" = dpCO2_seson, 
                         "Omega" = Omega_seson,
                         "pH" = pH_seson)
      
      modelsummary(Seasonal_models, stars = TRUE, 
                   #statistic = c('std.error', 'p.value', 'conf.int'),
                   title = 'Seasonal and spatial models'#,
                   #coef_map=factor_order
                   )
      #modelsummary(Omega_models, estimate = "p.value")
      
```

## Summary all inshore

```{r}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.dTA_seson_in <- data.frame(av.dTA_seson_in)
    av.dDIC_seson_in <- data.frame(av.dDIC_seson_in) 
    av.dPCO2_seson_in <- data.frame(av.dPCO2_seson_in)
    av.Ome_seson_in <- data.frame(av.Ome_seson_in) 
    av.pH_seson_in <- data.frame(av.pH_seson_in) 
    
    # Putting all into one dataframe/table
    anova_results_In <- data.frame(cbind
                    (c("Sub_region", "Season", "Sub_region:Season", 
                       
                       "Sub_region", "Season", "Sub_region:Season",
                       
                       "Sub_region", "Season", "Sub_region:Season",
                       
                       "Sub_region", "Season", "Sub_region:Season",
                       
                       "Sub_region", "Season", "Sub_region:Season"), 
                                      rbind(av.dTA_seson_in, av.dDIC_seson_in,
                                            av.dPCO2_seson_in,
                                            av.Ome_seson_in, av.pH_seson_in))) 
    colnames(anova_results_In) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_results_In) <- NULL
    
    # create HTML table using kableExtra
    anova_results_In %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "d TA inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "d DIC inshore", 4, 6)  %>% # groups rows with label
      pack_rows(., "d pCO2 inshore", 7, 9) %>% # groups rows with label
      pack_rows(., "Omega inshore", 10, 12)  %>% # groups rows with label
      pack_rows(., "pH inshore", 13, 15)  
    
    
#export_summs(dTA_seson, dDIC_seson, dpCO2_seson,  scale = TRUE)
    Seasonal_models_in<-list("d TA" = dTA_seson_in, 
                       "d DIC" = dDIC_seson_in, 
                       "d pCO2" = dpCO2_seson_in, 
                       "Omega" = Omega_seson_in,
                       "pH" = pH_seson_in)
    
    modelsummary(Seasonal_models_in, stars = TRUE, 
                 #statistic = c('std.error', 'p.value', 'conf.int'),
                 title = 'Seasonal and spatial models for inshore reefs'#,
                 #coef_map=factor_order
                 )
    #modelsummary(Omega_models, estimate = "p.value")
```


# 6 LMER long trend MODELS

* The F statistic in a regression model is used to test whether there is a linear model of the data - overall , or equivalently that your model is no better than a model with just the intercept. 

* The t statistic for a coefficient in a linear model tests the H0 that the true coefficient is 0. 

*The t-statistic is telling you about each coefficient individually. You can have a model with a low overall linear fit, but one individual coefficient may be relatively contributing a lot to explanation the variation in the DV that is explained on the assumption that there is a linear model.

Data and plots prep 

```{r}
Trends.data<-FLK.data_filtered[FLK.data_filtered$Year>2014, ]
#summary(Trends.data)

Reef.Trends.data<-WS.reef[WS.reef$Year>2014, ]
Reef.Trends.data<-Reef.Trends.data[Reef.Trends.data$Extreme=="Normal", ]
#summary(Reef.Trends.data$Extreme)

Trends.ocean<-Trends.data[Trends.data$Zone=="Oceanic", ]

Trends.offshore<-Reef.Trends.data[Reef.Trends.data$Zone=="Offshore", ]
Trends.midchanel<-Reef.Trends.data[Reef.Trends.data$Zone=="Mid channel", ]
Trends.inshore<-Reef.Trends.data[Reef.Trends.data$Zone=="Inshore", ]

Long_plot<- ggplot(Trends.data) +
        MyTheme +  
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank())+
        scale_x_date(date_breaks = "1 year",
                     date_labels = "%Y",
                     expand = c(0.02, 0.02))

factor_order <- c('Year'    = 'Year',
                  '(Intercept)' = 'Intercept',
                  'Sub_regionUK'    = 'Upper Keys',
                  'Sub_regionMK'    = 'Middle Keys',
                  'Sub_regionLK'    = 'Lower Keys')
        
```

# Omega-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$Aragonite_Sat_W)
shapiro.test(Trends.data$Aragonite_Sat_W) # Normality rejected
  
Omeaga_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Aragonite saturation state" ~(Omega[ar]))),
                       breaks = seq(0, 10, 0.5),  
                       expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=Aragonite_Sat_W, fill=Precipitation), 
             alpha=0.8, size=0.8, shape=21)

Omeaga_all+
    geom_smooth(aes (x=Date, y=Aragonite_Sat_W), method = "lm",
              color="black")

Omeaga_all+facet_grid(~Zone)+
    geom_smooth(aes (x=Date, y=Aragonite_Sat_W), method = "lm",
              color="black")

Omeaga_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=Aragonite_Sat_W, 
                   colour=Sub_region), 
              method = "lm", alpha=0.3)
```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore Omega
  hist(Trends.inshore$Aragonite_Sat_W)
  shapiro.test(Trends.inshore$Aragonite_Sat_W) # Normality rejected

  Omega_in<-lmer(Aragonite_Sat_W~Year * Sub_region + (1|Month)+
                                    #(1|Zone)+             
                                    (1|SiteID), data=Trends.inshore)
  #summary(Omega_in)    
  anova(Omega_in)
  ranova(Omega_in)
  step(Omega_in)
  
  Omega_in<-lmer(Aragonite_Sat_W ~ Sub_region + (1 | Month),
                 data=Trends.inshore)
  summary(Omega_in)
  
  plot(Omega_in)
  qqnorm(resid(Omega_in))
  acf(resid(Omega_in), main="acf(resid(Omega Inshore))")
  
  Arg_in.emmc<-emmeans(Omega_in, ~Sub_region)
    Arg_in.emmc<-multcomp::cld(Arg_in.emmc)
    #Arg_in.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    Arg_in.emmc<-Arg_in.emmc[order(Arg_in.emmc$Sub_region),]
    Arg_in.emmc
  #anova(Omega_in)
  #ranova(Omega_in)

```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$Aragonite_Sat_W)
shapiro.test(Trends.midchanel$Aragonite_Sat_W)# Normality rejected

Omega_mc<-lmer(Aragonite_Sat_W~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
#summary(Omega_mc)    
anova(Omega_mc)
ranova(Omega_mc)
step(Omega_mc)


Omega_mc<-lmer(Aragonite_Sat_W ~ Year + Sub_region + (1 | Month),
               data = Trends.midchanel)
  summary(Omega_mc) 
  plot(Omega_mc)
  qqnorm(resid(Omega_mc))
  acf(resid(Omega_mc), main="acf(resid(Omega mid Channel))")  
  
  Arg_md.emmc<-emmeans(Omega_mc, ~Sub_region+Year)
    Arg_md.emmc<-multcomp::cld(Arg_md.emmc)
    #Arg_in.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    Arg_md.emmc<-Arg_md.emmc[order(Arg_md.emmc$Sub_region),]
    Arg_md.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$Aragonite_Sat_W)
shapiro.test(Trends.offshore$Aragonite_Sat_W)# Normality rejected

Omega_of<-lmer(Aragonite_Sat_W~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
#summary(Omega_of)    
anova(Omega_of)
ranova(Omega_of)
step(Omega_of)

Omega_of<-lmer(Aragonite_Sat_W ~ Year + Sub_region + (1 | Month), 
               data =Trends.offshore)
  summary(Omega_of)
  plot(Omega_of)
  qqnorm(resid(Omega_of))
  acf(resid(Omega_of), main="acf(resid(Omega offshore))")  
  
  Arg_of.emmc<-emmeans(Omega_of, ~Sub_region+Year)
    Arg_of.emmc<-multcomp::cld(Arg_of.emmc)
    #Arg_in.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    Arg_of.emmc<-Arg_of.emmc[order(Arg_of.emmc$Sub_region),]
    Arg_of.emmc

```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$Aragonite_Sat_W)
shapiro.test(Trends.ocean$Aragonite_Sat_W)# Normality NOT rejected

Omega_oc<-lmer(Aragonite_Sat_W ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(Omega_oc)    
  anova(Omega_oc)
  ranova(Omega_oc)
  step(Omega_oc)

Omega_oc<-lmer(Aragonite_Sat_W ~ Year + (1 | Month), data = Trends.ocean)
  summary(Omega_oc)
  plot(Omega_oc)
  qqnorm(resid(Omega_oc))
  acf(resid(Omega_oc), main="acf(resid(Omega open))")
  
  Arg_oc.emmc<-emmeans(Omega_oc, ~Year)
    #Arg_oc.emmc<-multcomp::cld(Arg_oc.emmc)
    #Arg_oc.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    #Arg_oc.emmc<-Arg_oc.emmc[order(Arg_oc.emmc$Sub_region),]
    #Arg_oc.emmc

```

## Models summary 

```{r}
Omega_models<-list("Inshore" = Omega_in, 
                   "Mid channel" = Omega_mc, 
                   "Offshore" = Omega_of, 
                   "Ocean" = Omega_oc)
modelsummary(Omega_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'Omega model outputs',
             coef_map=factor_order)
#modelsummary(Omega_models, estimate = "p.value")

```

# pCO2-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$pCO2_uatm)
shapiro.test(Trends.data$pCO2_uatm)# Normality rejected

pCO2_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(0, 800, 50),  
                       expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=pCO2_uatm, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

pCO2_all+geom_smooth(aes (x=Date, y=pCO2_uatm), 
                     method = "lm", color="black")

pCO2_all+facet_grid(~Zone)+geom_smooth(aes (x=Date, y=pCO2_uatm), 
                     method = "lm", color="black")

pCO2_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=pCO2_uatm, colour=Sub_region),
              method = "lm", alpha=0.3)

```

## Inshore

```{r, fig.height=4, fig.width=4}

# Inshore pCO2
  hist(Trends.inshore$pCO2_uatm)
  shapiro.test(Trends.inshore$pCO2_uatm)# Normality NOT? rejected

  pCO2_in<-lmer(pCO2_uatm~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.inshore)
  #summary(pCO2_in)    
  anova(pCO2_in)
  ranova(pCO2_in)
  step(pCO2_in)

pCO2_in<-lmer(pCO2_uatm ~ (1|Month)+(1|SiteID), data=Trends.inshore)
  summary(pCO2_in)    
  plot(pCO2_in)
  qqnorm(resid(pCO2_in))
  acf(resid(pCO2_in), main="acf(resid(pCO2 Inshore))")  
  
  #pCO2_in.emmc<-emmeans(pCO2_in, ~Month)
      #pCO2_in.emmc<-multcomp::cld(pCO2_in.emmc)
      #pCO2_in.emmc<-pCO2_in.emmc[order(pCO2_in.emmc$Sub_region),]
      #pCO2_in.emmc
```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$pCO2_uatm)
shapiro.test(Trends.midchanel$pCO2_uatm)# Normality NOT rejected

pCO2_mc<-lmer(pCO2_uatm~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
  #summary(pCO2_mc)    
  anova(pCO2_mc)
  ranova(pCO2_mc)
  step(pCO2_mc)
  

pCO2_mc<-lmer(pCO2_uatm ~ Year + Sub_region + (1 | Month), 
              data = Trends.midchanel)
  summary(pCO2_mc) 
  plot(pCO2_mc)
  qqnorm(resid(pCO2_mc))
  acf(resid(pCO2_mc), main="acf(resid(pCO2 Mid Channel))")  
  
  pCO2_mc.emmc<-emmeans(pCO2_mc, ~Sub_region+Year)
        pCO2_mc.emmc<-multcomp::cld(pCO2_mc.emmc)
        pCO2_mc.emmc<-pCO2_mc.emmc[order(
          pCO2_mc.emmc$Sub_region),]
  pCO2_mc.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$pCO2_uatm)
shapiro.test(Trends.offshore$pCO2_uatm)# Normality rejected

pCO2_of<-lmer(pCO2_uatm~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(pCO2_of)    
  #anova(pCO2_of_0, pCO2_of_1, pCO2_of_2)
  anova(pCO2_of)
  ranova(pCO2_of)
  step(pCO2_of)

pCO2_of<-lmer(pCO2_uatm ~ Year + Sub_region + (1 | Month),
              data =Trends.offshore)
  summary(pCO2_of)
  plot(pCO2_of)
  qqnorm(resid(pCO2_of))
  acf(resid(Omega_in), main="acf(resid(pCO2 Offshore))")  
  
  pCO2_of.emmc<-emmeans(pCO2_of, ~Sub_region+Year)
        pCO2_of.emmc<-multcomp::cld(pCO2_of.emmc)
        pCO2_of.emmc<-pCO2_of.emmc[order(pCO2_of.emmc$Sub_region),]
  pCO2_of.emmc
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$pCO2_uatm)
shapiro.test(Trends.ocean$pCO2_uatm)# Normality rejected

pCO2_oc<-lmer(pCO2_uatm ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(pCO2_oc)    
  anova(pCO2_oc)
  ranova(pCO2_oc)
  step(pCO2_oc)

pCO2_oc<-lmer(pCO2_uatm ~ Year + (1 | Month), 
              data = Trends.ocean)
  summary(pCO2_oc)    
  plot(pCO2_oc)
  qqnorm(resid(pCO2_oc))
  acf(resid(pCO2_oc), main="acf(resid(pCO2 open))")
  
  pCO2_oc.emmc<-emmeans(pCO2_oc, ~Year)
        pCO2_oc.emmc<-multcomp::cld(pCO2_oc.emmc)
        #pCO2_oc.emmc<-pCO2_oc.emmc[order(pCO2_oc.emmc$Sub_region),]
  pCO2_oc.emmc
```

## Models summary 

```{r}
pCO2_models<-list("Inshore" = pCO2_in, 
                   "Mid channel" = pCO2_mc, 
                   "Offshore" = pCO2_of, 
                   "Ocean" = pCO2_oc)
modelsummary(pCO2_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'pCO2 models outputs',
             coef_map=factor_order)
#modelsummary(pCO2_models, estimate = "p.value")

```

# pH-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$pH_calculated)
shapiro.test(Trends.data$pH_calculated)# Normality rejected

pH_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("pH")),
                       breaks = seq(0, 10, 0.1),  
                       expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=pH_calculated, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

pH_all+ geom_smooth(aes (x=Date, y=pH_calculated),
                    method = "lm", color="black")

pH_all + facet_grid(~Zone)+ geom_smooth(aes (x=Date, y=pH_calculated),method = "lm", color="black")

pH_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=pH_calculated, colour=Sub_region), method = "lm", alpha=0.3)

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore pH
hist(Trends.inshore$pH_calculated)
shapiro.test(Trends.inshore$pH_calculated)# Normality rejected

pH_in<-lmer(pH_calculated~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID),
            data=Trends.inshore)
  #summary(pH_in)    
  anova(pH_in)
  ranova(pH_in)
  step(pH_in)

pH_in<-lmer(pH_calculated ~ Sub_region + (1 | Month) + (1 | SiteID),
            data=Trends.inshore)
  summary(pH_in)    
  plot(pH_in)
  qqnorm(resid(pH_in))
  acf(resid(pH_in), main="acf(resid(pH Inshore))")  
  
  pH_in.emmc<-emmeans(pH_in, ~Sub_region)
        pH_in.emmc<-multcomp::cld(pH_in.emmc)
        pH_in.emmc<-pH_in.emmc[order(pH_in.emmc$Sub_region),]
  pH_in.emmc
  
```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$pH_calculated)
shapiro.test(Trends.midchanel$pH_calculated)# Normality rejected

pH_mc<-lmer(pH_calculated~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID),
            data=Trends.midchanel)
  #summary(pH_mc)    
  anova(pH_mc)
  ranova(pH_mc)
  step(pH_mc)

pH_mc<-lmer(pH_calculated ~ Year + Sub_region + (1 | Month),
            data = Trends.midchanel)
  summary(pH_mc)
  plot(pH_mc)
  qqnorm(resid(pH_mc))
  acf(resid(pH_mc), main="acf(resid(pH Mid Channel))")  
  pH_mc.emmc<-emmeans(pH_mc, ~Sub_region)
        pH_mc.emmc<-multcomp::cld(pH_mc.emmc)
        pH_mc.emmc<-pH_mc.emmc[order(pH_mc.emmc$Sub_region),]
  pH_mc.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$pH_calculated)
shapiro.test(Trends.offshore$pH_calculated)# Normality rejected

pH_of<-lmer(pH_calculated~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(pH_of)    
  anova(pH_of)
  ranova(pH_of)
  step(pH_of)

pH_of<-lmer(pH_calculated ~ Year + Sub_region + (1 | Month), 
            data =Trends.offshore)
  summary(pH_of)    
  plot(pH_of)
  qqnorm(resid(pH_of))
  acf(resid(pH_of), main="acf(resid(pH Offshore))")
  
  pH_of.emmc<-emmeans(pH_of, ~Sub_region)
        pH_of.emmc<-multcomp::cld(pH_of.emmc)
        pH_of.emmc<-pH_of.emmc[order(pH_of.emmc$Sub_region),]
  pH_of.emmc
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$pH_calculated)
shapiro.test(Trends.ocean$pH_calculated)# Normality rejected

pH_oc<-lmer(pH_calculated ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(pH_oc)    
  anova(pH_oc)
  ranova(pH_oc)
  step(pH_oc)

pH_oc<-lmer(pH_calculated ~ Year + (1 | Month),
               data=Trends.ocean)
  summary(pH_oc)    
  plot(pH_oc)
  qqnorm(resid(pH_oc))
  acf(resid(pH_oc), main="acf(resid(pH ocean))")
  pH_oc.emmc<-emmeans(pH_oc, ~Year)
        pH_oc.emmc<-multcomp::cld(pH_oc.emmc)
        #pH_oc.emmc<-pH_oc.emmc[order(pH_oc.emmc$Sub_region),]
  pH_oc.emmc
```

## Models summary 

```{r}
pH_models<-list("Inshore" = pH_in, 
                   "Mid channel" = pH_mc, 
                   "Offshore" = pH_of, 
                   "Ocean" = pH_oc)
modelsummary(pH_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'pH model outputs',
             coef_map=factor_order)

#modelsummary(Omega_models, estimate = "p.value")

```

# TA-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$TA_umol_kg)
shapiro.test(Trends.data$TA_umol_kg)# Normality rejected

TA_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                      name=expression(paste("TA (", mu, "mol ", kg^-1, ")")),
                      breaks = seq(0, 3000, 100),  
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=TA_umol_kg, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

TA_all+
  geom_smooth(aes (x=Date, y=TA_umol_kg),
              method = "lm", color="black")
TA_all + facet_grid(~Zone) +
    geom_smooth(aes (x=Date, y=TA_umol_kg),
              method = "lm", color="black")

TA_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=TA_umol_kg, colour=Sub_region),
              method = "lm", alpha=0.3)

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore TA
hist(Trends.inshore$TA_umol_kg)
shapiro.test(Trends.inshore$TA_umol_kg)# Normality rejected

TA_in<-lmer(TA_umol_kg~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.inshore)
  #summary(TA_in)    
  anova(TA_in)
  ranova(TA_in)
  step(TA_in)

TA_in<-lmer(TA_umol_kg ~ Sub_region + (1 | Month), 
            data=Trends.inshore)
  summary(TA_in)    
  plot(TA_in)
  qqnorm(resid(TA_in))
  acf(resid(TA_in), main="acf(resid(TA Inshore))") 

  TA_in.emmc<-emmeans(TA_in, ~Sub_region)
        TA_in.emmc<-multcomp::cld(TA_in.emmc)
        TA_in.emmc<-TA_in.emmc[order(TA_in.emmc$Sub_region),]
  TA_in.emmc
```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$TA_umol_kg)
shapiro.test(Trends.midchanel$TA_umol_kg)# Normality rejected

TA_mc<-lmer(TA_umol_kg~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID),
            data=Trends.midchanel)
  #summary(TA_mc)    
  anova(TA_mc)
  ranova(TA_mc)
  step(TA_mc)

TA_mc<-lmer(TA_umol_kg ~ (1 | Month) + (1|SiteID), 
            data = Trends.midchanel)
  summary(TA_mc) 
  plot(TA_mc)
  qqnorm(resid(TA_mc))
  acf(resid(TA_mc), main="acf(resid(TA Mid Channel))") 
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$TA_umol_kg)
shapiro.test(Trends.offshore$TA_umol_kg)# Normality rejected

TA_of<-lmer(TA_umol_kg~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(TA_of)    
  anova(TA_of)
  ranova(TA_of)
  step(TA_of)

TA_of<-lmer(TA_umol_kg ~ Year + Sub_region + (1 | Month), 
            data =Trends.offshore)
  summary(TA_of)    
  plot(TA_of)
  qqnorm(resid(TA_of))
  acf(resid(TA_of), main="acf(resid(TA Offshore))") 
  
  TA_of.emmc<-emmeans(TA_of, ~Sub_region)
        TA_of.emmc<-multcomp::cld(TA_of.emmc)
        TA_of.emmc<-TA_of.emmc[order(TA_of.emmc$Sub_region),]
  TA_of.emmc

```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$TA_umol_kg)
shapiro.test(Trends.ocean$TA_umol_kg)# Normality NOT rejected

TA_oc<-lmer(TA_umol_kg ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(TA_oc)    
  anova(TA_oc)
  ranova(TA_oc)
  step(TA_oc)

TA_oc<-lmer(TA_umol_kg ~ (1 | Month), 
            data = Trends.ocean)
  summary(TA_oc)    
  plot(TA_oc)
  qqnorm(resid(TA_oc))
  acf(resid(TA_oc), main="acf(resid(TA_Ocean))")
  
  # TA_oc.emmc<-emmeans(TA_oc, ~Sub_region)
  #       TA_oc.emmc<-multcomp::cld(TA_oc.emmc)
  #       TA_oc.emmc<-TA_oc.emmc[order(TA_oc.emmc$Sub_region),]
  # TA_oc.emmc
```

## Models summary 
```{r}
TA_models<-list("Inshore" = TA_in, 
                   "Mid channel" = TA_mc, 
                   "Offshore" = TA_of, 
                   "Ocean" = TA_oc)
modelsummary(TA_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'TA model outputs',
             coef_map=factor_order)
#modelsummary(TA_models, estimate = "p.value")
```

# DIC-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$DIC_umol_kg)
shapiro.test(Trends.data$DIC_umol_kg)# Normality rejected

DIC_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                      name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")),
                      breaks = seq(0, 3000, 100),  
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=DIC_umol_kg, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)
    

DIC_all + 
  geom_smooth(aes (x=Date, y=DIC_umol_kg), method = "lm", color="black")

DIC_all + facet_grid(~Zone) + geom_smooth(aes (x=Date, y=DIC_umol_kg), method = "lm", color="black")

DIC_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=DIC_umol_kg, colour=Sub_region), method = "lm")

```

## Inshore

```{r, fig.height=4, fig.width=4}
hist(Trends.inshore$DIC_umol_kg)
shapiro.test(Trends.inshore$DIC_umol_kg)# Normality NOT rejected

# Inshore DIC
DIC_in<-lmer(DIC_umol_kg~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID),
             data=Trends.inshore)
  #summary(DIC_in)    
  anova(DIC_in)
  ranova(DIC_in)
  step(DIC_in)

DIC_in<-lmer(DIC_umol_kg ~ Year + Sub_region +
               (1|Month) + (1|SiteID), data=Trends.inshore)
  summary(DIC_in)    
  plot(DIC_in)
  qqnorm(resid(DIC_in))
  acf(resid(DIC_in), main="acf(resid(DIC Inshore))") 
  
  DIC_in.emmc<-emmeans(DIC_in, ~Sub_region+Year)
         DIC_in.emmc<-multcomp::cld(DIC_in.emmc)
         DIC_in.emmc<-DIC_in.emmc[order(DIC_in.emmc$Sub_region),]
  DIC_in.emmc

```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$DIC_umol_kg)
shapiro.test(Trends.midchanel$DIC_umol_kg)# Normality rejected

DIC_mc<-lmer(DIC_umol_kg~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
  #summary(DIC_mc)    
  anova(DIC_mc)
  ranova(DIC_mc)
  step(DIC_mc)

DIC_mc<-lmer(DIC_umol_kg ~ Year + Sub_region + (1 | Month), 
             data = Trends.midchanel)
  summary(DIC_mc) 
  plot(DIC_mc)
  qqnorm(resid(DIC_mc))
  acf(resid(DIC_mc), main="acf(resid(DIC Mid Channel))") 
  
  DIC_mc.emmc<-emmeans(DIC_mc, ~Sub_region+Year)
         DIC_mc.emmc<-multcomp::cld(DIC_mc.emmc)
         DIC_mc.emmc<-DIC_mc.emmc[order(DIC_mc.emmc$Sub_region),]
  DIC_mc.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$DIC_umol_kg)
shapiro.test(Trends.offshore$DIC_umol_kg)# Normality rejected

DIC_of<-lmer(DIC_umol_kg~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(DIC_of)    
  anova(DIC_of)
  ranova(DIC_of)
  step(DIC_of)

DIC_of<-lmer(DIC_umol_kg ~ Year + Sub_region + (1 | Month),
             data =Trends.offshore)
  summary(DIC_of)
  plot(DIC_of)
  qqnorm(resid(DIC_of))
  acf(resid(DIC_of), main="acf(resid(DIC Offshore))") 
  
  DIC_of.emmc<-emmeans(DIC_of, ~Sub_region+Year)
         DIC_of.emmc<-multcomp::cld(DIC_of.emmc)
         DIC_of.emmc<-DIC_of.emmc[order(DIC_of.emmc$Sub_region),]
  DIC_of.emmc
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$DIC_umol_kg)
shapiro.test(Trends.ocean$DIC_umol_kg)# Normality rejected

DIC_oc<-lmer(DIC_umol_kg ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(DIC_oc)    
  anova(DIC_oc)
  ranova(DIC_oc)
  step(DIC_oc)

DIC_oc<-lmer(DIC_umol_kg ~ Year+ (1 | Month), data = Trends.ocean)
  summary(DIC_oc)    
  plot(DIC_oc)
  qqnorm(resid(DIC_oc))
  acf(resid(DIC_oc), main="acf(resid(DIC open))")
  
  DIC_oc.emmc<-emmeans(DIC_oc, ~Year)
         DIC_oc.emmc<-multcomp::cld(DIC_oc.emmc)
         #DIC_oc.emmc<-DIC_oc.emmc[order(DIC_oc.emmc$Sub_region),]
  DIC_oc.emmc
```

## Models summary 
```{r}
DIC_models<-list("Inshore" = DIC_in, 
                   "Mid channel" = DIC_mc, 
                   "Offshore" = DIC_of, 
                   "Ocean" = DIC_oc)
modelsummary(DIC_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'DIC model outputs',
             coef_map=factor_order)
#modelsummary(DIC_models, estimate = "p.value")
```

# dTA-All

```{r}
Long_plot2<- ggplot(Reef.Trends.data) +
        MyTheme +  
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank())
```


```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Reef.Trends.data$dTA_MY)
shapiro.test(Reef.Trends.data$dTA_MY)# Normality rejected

dTA_all<- Long_plot2+
    scale_y_continuous(#limits = c(15,40),
                      breaks = seq(-500, 500, 100),
                      name=expression(paste(Delta, " TA (", mu, "mol ", kg^-1, ")")),
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=dTA_MY, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

dTA_all +
    geom_smooth(aes (x=Date, y=dTA_MY), method = "lm",
                color="black")

dTA_all+facet_grid(~Zone)+ 
    geom_smooth(aes (x=Date, y=dTA_MY), method = "lm",
                color="black")

dTA_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=dTA_MY, colour=Sub_region),
              method = "lm")

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore dTA
hist(Trends.inshore$dTA_MY)
shapiro.test(Trends.inshore$dTA_MY)# Normality rejected


dTA_in<-lmer(dTA_MY ~ Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID),
             data=Trends.inshore)
  #summary(dTA_in)    
  anova(dTA_in)
  ranova(dTA_in)
  step(dTA_in)

dTA_in<-lmer(dTA_MY ~ Sub_region + (1 | Month),
             data=Trends.inshore)
  summary(dTA_in)    
  plot(dTA_in)
  qqnorm(resid(dTA_in))
  acf(resid(dTA_in), main="acf(resid(dTA Inshore))")
  
  dTA_in.emmc<-emmeans(dTA_in, ~Sub_region)
         dTA_in.emmc<-multcomp::cld(dTA_in.emmc)
         dTA_in.emmc<-dTA_in.emmc[order(dTA_in.emmc$Sub_region),]
  dTA_in.emmc
```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$dTA_MY)
shapiro.test(Trends.midchanel$dTA_MY)# Normality rejected

dTA_mc<-lmer(dTA_MY~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID),
             data=Trends.midchanel)
  #summary(dTA_mc)    
  anova(dTA_mc)
  ranova(dTA_mc)
  step(dTA_mc)

dTA_mc<-lmer(dTA_MY ~ (1 | Month) + (1|SiteID), 
             data = Trends.midchanel)
  summary(dTA_mc) 
  plot(dTA_mc)
  qqnorm(resid(dTA_mc))
  acf(resid(dTA_mc), main="acf(resid(dTA Mid Channel))") 
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$dTA_MY)
shapiro.test(Trends.offshore$dTA_MY)# Normality rejected

dTA_of<-lmer(dTA_MY~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(dTA_of)    
  anova(dTA_of)
  ranova(dTA_of)
  step(dTA_of)

dTA_of<-lmer(dTA_MY ~ Sub_region + (1 | Month), 
             data =Trends.offshore)
  summary(dTA_of)    
  plot(dTA_of)
  qqnorm(resid(dTA_of))
  acf(resid(dTA_of), main="acf(resid(dTA Offshore))") 
  
  dTA_of.emmc<-emmeans(dTA_of, ~Sub_region)
         dTA_of.emmc<-multcomp::cld(dTA_of.emmc)
         dTA_of.emmc<-dTA_of.emmc[order(dTA_of.emmc$Sub_region),]
  dTA_of.emmc
```

## Models summary 

```{r}
dTA_models<-list("Inshore" = dTA_in, 
                   "Mid channel" = dTA_mc, 
                   "Offshore" = dTA_of)
modelsummary(dTA_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'dTA model outputs',
             coef_map=factor_order)
#modelsummary(dTA_models, estimate = "p.value")
```

# dDIC-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Reef.Trends.data$dDIC_MY)
shapiro.test(Reef.Trends.data$dDIC_MY)# Normality rejected

dDIC_all<- Long_plot2+
    scale_y_continuous(#limits = c(15,40),
                      name=expression(paste(Delta, " DIC (", mu, "mol ", kg^-1, ")")),
                      breaks = seq(-900, 900, 100),  
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=dDIC_MY, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

dDIC_all+ 
    geom_smooth(aes (x=Date, y=dDIC_MY),
                method = "lm", color="black")

dDIC_all + facet_grid(~Zone) + geom_smooth(aes (x=Date, y=dDIC_MY),
                method = "lm", color="black")

dDIC_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=dDIC_MY, colour=Sub_region),
              method = "lm")

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore dDIC
hist(Trends.inshore$dDIC_MY)
shapiro.test(Trends.inshore$dDIC_MY)# Normality rejected

dDIC_in<-lmer(dDIC_MY~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID), 
              data=Trends.inshore)
  #summary(dDIC_in)    
  anova(dDIC_in)
  ranova(dDIC_in)
  step(dDIC_in)
  
dDIC_in<-lmer(dDIC_MY ~ Sub_region + (1 | Month)+ (1 | SiteID),
              data=Trends.inshore)
  summary(dDIC_in)    
  plot(dDIC_in)
  qqnorm(resid(dDIC_in))
  acf(resid(dDIC_in), main="acf(resid(dDIC Inshore))") 
  
  dDIC_in.emmc<-emmeans(dDIC_in, ~Sub_region)
         dDIC_in.emmc<-multcomp::cld(dDIC_in.emmc)
         dDIC_in.emmc<-dDIC_in.emmc[order(dDIC_in.emmc$Sub_region),]
  dDIC_in.emmc
```

## Mid channel 

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$dDIC_MY)
shapiro.test(Trends.midchanel$dDIC_MY)# Normality rejected

dDIC_mc<-lmer(dDIC_MY~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
  #summary(dDIC_mc)    
  anova(dDIC_mc)
  ranova(dDIC_mc)
  step(dDIC_mc)

dDIC_mc<-lmer(dDIC_MY ~ Sub_region + (1 | Month),
              data = Trends.midchanel)
  summary(dDIC_mc) 
  plot(dDIC_mc) 
  qqnorm(resid(dDIC_mc))
  acf(resid(dDIC_mc), main="acf(resid(dDIC Mid Channel))") 
  
  dDIC_mc.emmc<-emmeans(dDIC_mc, ~Sub_region)
         dDIC_mc.emmc<-multcomp::cld(dDIC_mc.emmc)
         dDIC_mc.emmc<-dDIC_mc.emmc[order(dDIC_mc.emmc$Sub_region),]
  dDIC_mc.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$dDIC_MY)
shapiro.test(Trends.offshore$dDIC_MY)# Normality rejected

dDIC_of<-lmer(dDIC_MY~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(dDIC_of)    
  anova(dDIC_of)
  ranova(dDIC_of)
  step(dDIC_of)

dDIC_of<-lmer(dDIC_MY ~ Year+ Sub_region + (1 | Month), 
              data =Trends.offshore)
  summary(dDIC_of)    
  plot(dDIC_of)
  qqnorm(resid(dDIC_of))
  acf(resid(dDIC_of), main="acf(resid(dDIC Offshore))") 
  
  dDIC_of.emmc<-emmeans(dDIC_of, ~Sub_region+Year)
         dDIC_of.emmc<-multcomp::cld(dDIC_of.emmc)
         dDIC_of.emmc<-dDIC_of.emmc[order(dDIC_of.emmc$Sub_region),]
  dDIC_of.emmc

```

## Models summary 

```{r}
dDIC_models<-list("Inshore" = dDIC_in, 
                   "Mid channel" = dDIC_mc, 
                   "Offshore" = dDIC_of)
modelsummary(dDIC_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'dDIC model outputs',
             coef_map=factor_order)
#modelsummary(dDIC_models, estimate = "p.value")
```

# 7. PCA

```{r}
#str(Month_Stats)
PCA_variables<-c("DIC_mean", "TA_mean", "pCO2_mean", "Ara_mean",
              "pH_mean", "Tem_mean","Sal_mean", "Season",
              "Zone", "Sub_region", "Month")

PCA.data<-select(Month_Stats, PCA_variables)

Name<-paste(Month_Stats$Zone, Month_Stats$Sub_region, 
            Month_Stats$Month, sep = "_")
rownames(PCA.data) <- (Name)
PCA_var.names<-c("DIC", "TA", "pCO2", "Ara",
              "pH", "Temp","Sal", "Season",
              "Zone", "Sub_region", "Month")
colnames(PCA.data) <- (PCA_var.names)
#ggpairs(PCA.data)
```

```{r}
head(PCA.data)
library(vegan)
library(autoplot)
library(ggfortify)

CC.rda1 <- rda(PCA.data[, -(6:11)], scale=TRUE)
CC.rda2 <- prcomp(PCA.data[, -(6:11)], scale=TRUE)
summary(CC.rda1)

# Checking if the PC axes are meaningful
eigenval <- CC.rda1$CA$eig   # Here you will get the eigenvalues
sitecoord <- CC.rda1$CA$u[,1:2]   # The site coordinates along PC1 and PC2
  eig <- data.frame(eigenval)
  eig$nb <- c(1:length(eigenval))
  eig$prop <- eig$eigenval/sum(eig$eigenval)
  eig
  
# (Kaiser-Guttman)
par(mfrow=c(1,2))
  barplot(eig$eigenval, main="Eigenvalues",las=2)
  abline(h=mean(eig$eigenval),col="red")    # average eigenvalue
  legend("topright","Average eigenvalue",lwd=1,col=2,bty="n")
  
  barplot(100*eig$prop,main="% of variance",las=2)
par(mfrow=c(1,1))

autoplot(CC.rda2, data = PCA.data, colour="Season", 
                shape="Sub_region",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_wrap(~Zone)+MyTheme+Season_colour+Season_fill

autoplot(CC.rda2, data = PCA.data, colour="Zone", 
                shape="Sub_region",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_wrap(~Season)+MyTheme

autoplot(CC.rda2, data = PCA.data, colour="Season", 
                shape="Zone",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_wrap(~Sub_region)+MyTheme+Season_colour+Season_fill

```
